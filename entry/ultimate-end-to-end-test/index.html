<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> 
<title>Testing Is Documenting: Ultimate End To End Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-153393045-1', 'auto');
    ga('send', 'pageview');
</script><link rel="stylesheet" type="text/css" href="/blog/static/css/katex.min.css">
<link rel="stylesheet" type="text/css" href="/blog/static/main.css">
<link rel="stylesheet" type="text/css" href="/blog/static/blog-style.css">
<link rel="stylesheet" type="text/css" href="/blog/static/css/global-overrides.css">
<link rel="stylesheet" type="text/css" href="/blog/style.css">
</head>
<link rel="shortcut icon" href="/blog/favicon.png"type="image/ico"/>
<body class="theme-znai-dark">
<script>(function() {
    var themeNameKey = 'znaiTheme';
    var darkThemeName = 'znai-dark';
    var lightThemeName = 'default';

    var znaiTheme = {
        changeHandlers: [],
        addChangeHandler(handler) {
            this.changeHandlers.push(handler);
        },
        removeChangeHandler(handler) {
            var idx = this.changeHandlers.indexOf(handler);
            this.changeHandlers.splice(idx, 1);
        },
        set(name) {
            this.name = name;
            document.body.className = 'theme-' + name;

            var idx = 0;
            var len = this.changeHandlers.length;
            for (; idx < len; idx++) {
                this.changeHandlers[idx](name);
            }
        },
        setExplicitly(name) {
            storeThemeName(name);
            this.set(name);
        },
        setExplicitlyIfNotSetAlready(name) {
            const themeName = getStoredThemeName();
            if (themeName) {
                return
            }

            this.setExplicitly(name)
        },
        toggle() {
            this.setExplicitly(this.name === lightThemeName ? darkThemeName : lightThemeName)
        }
    };

    var mediaThemeName = setLightMatchMediaListenerAndGetThemeName()
    var themeName = getStoredThemeName() || mediaThemeName;
    znaiTheme.set(themeName);

    window.znaiTheme = znaiTheme;

    function getStoredThemeName() {
        return localStorage.getItem(themeNameKey);
    }

    function storeThemeName(name) {
        return localStorage.setItem(themeNameKey, name);
    }

    function setLightMatchMediaListenerAndGetThemeName() {
        if (!window.matchMedia) {
            return darkThemeName;
        }

        var lightQuery = window.matchMedia('(prefers-color-scheme: light)');
        lightQuery.addListener(function (e) {
            const newThemeName = e.matches ? lightThemeName : darkThemeName;
            znaiTheme.setExplicitly(newThemeName);
        });

        return lightQuery.matches ? lightThemeName : darkThemeName;
    }
})()</script>
<div id="znai"><div id="znai-initial-page-loading" style="margin: -20px 0 0 -20px; padding: 0 40px 40px 0; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center">
    <div></div>
</div><section style="max-width: 640px; margin-left: auto; margin-right: auto;">
<article>
<header><h1>WebTau</h1></header>
<p>WebTau stands for Web Tests Automation. An open source tool, API, and a framework designed to simplify testing on multiple levels.What do I mean by multiple levels? Apps I develop often have these layers:REST/GraphQL API Web UI Command Line Database When I write end-to-end tests I test on one layer, and validate on the other. I write a test for a command line tool and validate that CLI updates REST resource. I write a test for Web UI and use GraphQL API to set up the initial data.</p>
</article>

<article>
<header><h1>Game Store</h1></header>
<p>We are going to test Game Store product. It has Web UI where you can see what games are available.It has CLI tool to help admins to manage the product. gs-admin list List of games g1 Slay The Spire card rpg 20.0 g2 Civilization 6 strategy 60.0 g3 Doom fps 60.0 g4 Last Of Us 2 adventure drama 60.0 g5 Inside adventure 10.0 g6 Hearthstone card 0.0 g7 Division 2 shooter rpg 30.0 g8 Assassin Creed Odyssey rpg 40.0 It has GraphQL and REST API to manage data. def query = ''' query { game(id: &quot;g1&quot;) { title type } } ''' Game Store product puts all the data into a database. Below we are going to see how webtau lets you seamlessly test on different layers and use other layers to help with data validation.</p>
</article>

<article>
<header><h1>WebTau Introduction</h1></header>
<p>Before writing a test for Game Store, we are going to use https://jsonplaceholder.typicode.com/ JSON Placeholder website to demo basic webtau parts.Our goal is to get and validate a response from this end point: https://jsonplaceholder.typicode.com/todos/1 In webtau use scenario to define a test. Let's create a file and define our first scenario: scenario('basic http invocation') { http.get('https://jsonplaceholder.typicode.com/todos/1') { body.title.should == 'delectus aut autem' // automatic mapping of a field name to a JSON response completed.should == false // specifying body is optional } } Note: Most of the time we are going to use webtau as both API and command line runner. You can use webtau with JUnit5 and JUnit4 and pure Java if you prefer.To run a test, assuming webtau is in PATH : webtau httpBasics.groovy basic http invocation (httpBasics.groovy) &gt; executing HTTP GET https://jsonplaceholder.typicode.com/todos/1 . body.title equals &quot;delectus aut autem&quot; matches: body.title: actual: &quot;delectus aut autem&quot; &lt;java.lang.String&gt; expected: &quot;delectus aut autem&quot; &lt;java.lang.String&gt; (36ms) . body.completed equals false matches: body.completed: actual: false &lt;java.lang.Boolean&gt; expected: false &lt;java.lang.Boolean&gt; (2ms) . header.statusCode equals 200 matches: header.statusCode: actual: 200 &lt;java.lang.Integer&gt; expected: 200 &lt;java.lang.Integer&gt; (0ms) response (application/json; charset=utf-8): { &quot;userId&quot;: 1, &quot;id&quot;: 1, &quot;title&quot;: __&quot;delectus aut autem&quot;__, &quot;completed&quot;: __false__ } . executed HTTP GET https://jsonplaceholder.typicode.com/todos/1 (317ms) Webtau captures everything that happens in a test:commands there were ran assertions that were made (both passed and failed) values that were checked ( __ in the console output) All the captured data is available after test run inside a rich html report that we are going to look at later.</p>
</article>

<article>
<header><h1>Basic Configuration</h1></header>
<p>To avoid writing full url in our tests let's define a base url for our service, UI and define an additional environment: url = &quot;http://localhost:8080&quot; // base url for all http and browser requests browserUrl = &quot;http://localhost:3000&quot; // base url for browser open commands. Overrides url above if both are present browserId = &quot;firefox&quot; // specifying browser to use for browser based operations environments { dev { // optional overrides for the configs for dev environment url = &quot;http://dev-server:8080&quot; browserUrl = &quot;http://dev-server:8080&quot; } } scenario('implicit config usage') { http.post(&quot;/relative-url&quot;) // implicit usage of core url config value browser.open(&quot;/test&quot;) // implicit usage of browser url and browser id } You can override config values using CLI params. Use --env=&lt;value&gt; to select an environment, i.e. a different set of config values: webtau scenarios/* --env=dev --url=http://override-value --browserId=chrome</p>
</article>

<article>
<header><h1>Game Store REST API</h1></header>
<p>Let's test Game Store API to register and check a game by id. http://localhost:8080/api/game scenario('register new game') { http.post(&quot;/api/game&quot;, [ id: &quot;g1&quot;, // define payload as a map title: &quot;Slay The Spire&quot;, type: &quot;card rpg&quot;, priceUsd: 20]) http.get(&quot;/api/game/g1&quot;) { // request newly created game as GET id.should == &quot;g1&quot; title.should == &quot;Slay The Spire&quot; // direct access to response JSON title property type.should == &quot;card rpg&quot; priceUsd.should == 20 } } Did you notice that request to POST and response from GET looks the same? Let's extract payload into a variable and re-use it for both request payload and response validation. This time we also not going to pass id to the request and instead rely on the server to generate a new ID. package scenarios.gamestore // optional package declaration for IDE happiness import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* // optional single import for IDE autocomplete scenario('register new game') { def payload = [title: &quot;Slay The Spire&quot;, // no ID specified this time type: &quot;card rpg&quot;, priceUsd: 20] def id = http.post(&quot;/api/game&quot;, payload) { return id // we grab id from response, return keyword is optional } http.get(&quot;/api/game/${id}&quot;) { // using id for subsequent request body.should == payload // re-using POST payload to assert GET response. Only values in payload will be validated } }</p>
</article>

<article>
<header><h1>HTTP Explicit Auth</h1></header>
<p>End-point /api/game was not requiring authentication. It was done for example&rsquo;s sake to make it simpler to approach. Now let's test an end-point that requires auth. scenario('save preferences without auth') { http.put('/api/user-preferences', [favoriteGenre: 'RPG']) { statusCode.should == 403 // forbidden, as this end-point requires authentication } } To authenticate a user our system relies on Bearer token. Let's generate a token and explicitly pass it via header parameter. scenario('save preferences with explicit auth') { def token = generateToken('user-a') // generates token using our system underlying auth system http.put('/api/user-preferences', http.header([Authorization: &quot;Bearer ${token}&quot;]), // explicitly pass Bearer token [favoriteGenre: 'RPG']) { userId.should == 'user-a' // make sure server recognized token and properly authenticated user } }</p>
</article>

<article>
<header><h1>Personas</h1></header>
<p>Webtau provides a way to implement implicit authentication for your requests. Before we get there, we need to cover Persona concept. Persona sets the context for config values and code execution. userId = 'NA' // custom config value defined in the default context personas { // persona config section, similar to environments config section Alice { userId = &quot;uid-alice&quot; // Alice's specific config value } Bob { userId = &quot;uid-bob&quot; // Bob's specific config value } } def Alice = persona('Alice') // define Alice persona def Bob = persona('Bob') // define Bob persona scenario('persona demo') { println cfg.userId // custom value from config Alice { println cfg.userId // custom value from config in Alice's context } Bob { println cfg.userId // custom value from config in Bob's context } } persona demo (personaDemo.groovy) NA uid-alice uid-bob</p>
</article>

<article>
<header><h1>HTTP Implicit Auth</h1></header>
<p>Instead of explicitly passing header to each http call we will execute calls in the context of a persona. scenario('save preferences with personas auth') { Alice { // Alice's context http.put('/api/user-preferences', [favoriteGenre: 'RPG']) { userId.should == 'uid-alice' // validating that we updated the right user favoriteGenre.should == 'RPG' } } Bob { // Bob's context http.put('/api/user-preferences', [favoriteGenre: 'Strategy']) { userId.should == 'uid-bob' // validating that we updated the right user favoriteGenre.should == 'Strategy' } } } Console output (and report that we are going to look at later) captures what steps were executed in what context. running: scenarios/gamestore/userPreferencesRest.groovy save preferences with personas auth save preferences with personas auth (userPreferencesRest.groovy) &gt; Alice executing HTTP PUT http://localhost:8080/api/user-preferences request (application/json): { &quot;favoriteGenre&quot;: &quot;RPG&quot; } . Alice body.userId equals &quot;uid-alice&quot; matches: body.userId: actual: &quot;uid-alice&quot; &lt;java.lang.String&gt; expected: &quot;uid-alice&quot; &lt;java.lang.String&gt; (18ms) . Alice body.favoriteGenre equals &quot;RPG&quot; matches: body.favoriteGenre: actual: &quot;RPG&quot; &lt;java.lang.String&gt; expected: &quot;RPG&quot; &lt;java.lang.String&gt; (0ms) . Alice header.statusCode equals 200 matches: header.statusCode: actual: 200 &lt;java.lang.Integer&gt; expected: 200 &lt;java.lang.Integer&gt; (1ms) &gt; Alice validating request and response . Alice validated request and response (149ms) response (application/json): { &quot;userId&quot;: __&quot;uid-alice&quot;__, &quot;favoriteGenre&quot;: __&quot;RPG&quot;__ } . Alice executed HTTP PUT http://localhost:8080/api/user-preferences (320ms) &gt; Bob executing HTTP PUT http://localhost:8080/api/user-preferences To make sure our PUT worked as intended we are going to GET user preferences in different Persona contexts. scenario('read preferences with personas auth') { Alice { // Alice's context http.get('/api/user-preferences') { favoriteGenre.should == 'RPG' // we get back the Alice's favorite genre } } Bob { // Bob's context http.get('/api/user-preferences') { favoriteGenre.should == 'Strategy' // we get back the Bob's favorite genre } } } How does it work behind the covers? Webtau allows you to define an implicit HTTP Header Provider that can inject header values into each request. httpHeaderProvider = HttpHeaderProvider.&amp;provide // implicit header provider userId = '' // explicitly set default userId to be an empty string personas { Alice { userId = 'uid-alice' // Alice's system specific user id } Bob { userId = 'uid-bob' // Bob's system specific user id } } Our custom implementation of HTTP Header Provider checks cfg.userId value and when it is present, it will be used to generate Bearer token and inject into ongoing request.Note: cfg.userId is only set in the context of Bob or Alice . Outside persona context userId is an empty value. package auth import org.testingisdocumenting.webtau.http.HttpHeader import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class HttpHeaderProvider { static provide(String fullUrl, String url, // provide method will be called for every HTTP request HttpHeader httpHeaders) { def userId = cfg.userId // grab custom userId config value, depends on the Persona context. Based on our current config, it is empty outside persona context. return userId ? httpHeaders.with(&quot;Authorization&quot;, // create new http header by taking a header passed by a test explicitly and adding Authorization key-value &quot;Bearer ${generateToken(userId)}&quot;): httpHeaders // original header passed by a test } // generate token based on your auth system, dummy impl for the demo purposes only private static def generateToken(String userId) { return userId.bytes.encodeBase64().toString() } }</p>
</article>

<article>
<header><h1>GraphQL</h1></header>
<p>We covered how to use http. namespace to test REST based API layer. Let's move to graphql. namespace to test GraphQL based API.Game Store provided a few queries and mutations: type Query { games: [Game] game(id: String): Game userPreferences: UserPreferences } type Mutation { createGame(id: String!, title: String!, type: String!, priceUsd: Int!): Game updateUserPreferences(favoriteGenre: String): UserPreferences } type Game { id: String title: String type: String priceUsd: Int } type UserPreferences { userId: String favoriteGenre: String } To start, we define a query to fetch a game by hardcoding id in the query. def query = ''' query { game(id: &quot;g1&quot;) { title type } } ''' scenario('query game') { graphql.execute(query) { game.title.should == &quot;Slay The Spire&quot; // explicit access through query name title.should == &quot;Slay The Spire&quot; // implicit access in case of the single query } } GraphQL allows to define a query with parameters: def queryWithParams = ''' query game($id: String!) { game(id: $id) { title type } } ''' Webtau provides a way to pass parameter values as a Map : scenario('query game with param') { graphql.execute(queryWithParams, [id: 'g1']) { title.should == &quot;Slay The Spire&quot; } }</p>
</article>

<article>
<header><h1>GraphQL Explicit Auth</h1></header>
<p>As in REST based user preference example above, updateUserPreferences mutation requires authentication. def mutation = ''' mutation updateUserPreferences($favoriteGenre: String!) { updateUserPreferences(favoriteGenre: $favoriteGenre) { userId favoriteGenre } } ''' Unlike REST based API, the auth error appears in errors field on a response and not via statusCode : scenario('save preferences without auth') { graphql.execute(mutation, [favoriteGenre: 'CRPG']) { errors.message.should == ['forbidden'] // shortcut to take a message from each error in the list } } To do auth explicitly, similar to REST API, we can pass header as a parameter to graphql.execute : scenario('save preferences with explicit auth') { def token = generateToken('user-a') graphql.execute(mutation, [favoriteGenre: 'CRPG'], http.header([Authorization: &quot;Bearer ${token}&quot;])) { userId.should == 'user-a' } }</p>
</article>

<article>
<header><h1>GraphQL Persona Auth</h1></header>
<p>Persona based authentication for GraphQL works exactly like REST API based one. scenario('save preferences with personas auth') { Alice { // Personas we defined and used for HTTP REST API graphql.execute(mutation, [favoriteGenre: 'RPG']) { userId.should == 'uid-alice' // make sure system picked Alice as a user favoriteGenre.should == 'RPG' } } Bob { graphql.execute(mutation, [favoriteGenre: 'Strategy']) { userId.should == 'uid-bob' // make sure system picked Bob as a user favoriteGenre.should == 'Strategy' } } } httpHeaderProvider = HttpHeaderProvider.&amp;provide // implicit header provider userId = '' // explicitly set default userId to be an empty string personas { Alice { userId = 'uid-alice' // Alice's system specific user id } Bob { userId = 'uid-bob' // Bob's system specific user id } } package auth import org.testingisdocumenting.webtau.http.HttpHeader import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class HttpHeaderProvider { static provide(String fullUrl, String url, // provide method will be called for every HTTP request HttpHeader httpHeaders) { def userId = cfg.userId // grab custom userId config value, depends on the Persona context. Based on our current config, it is empty outside persona context. return userId ? httpHeaders.with(&quot;Authorization&quot;, // create new http header by taking a header passed by a test explicitly and adding Authorization key-value &quot;Bearer ${generateToken(userId)}&quot;): httpHeaders // original header passed by a test } // generate token based on your auth system, dummy impl for the demo purposes only private static def generateToken(String userId) { return userId.bytes.encodeBase64().toString() } } Let's make system reflects the changes performed with mutations def query = ''' query { userPreferences { userId favoriteGenre } } ''' scenario('read preferences with personas auth') { Alice { graphql.execute(query) { favoriteGenre.should == 'RPG' // making sure correct data is returned back } } Bob { graphql.execute(query) { favoriteGenre.should == 'Strategy' // Strategy games are not bad } } }</p>
</article>

<article>
<header><h1>Personas Re-use</h1></header>
<p>We started with defining personas in-place within each test file like this: import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* def Alice = persona('Alice') // define Alice persona def Bob = persona('Bob') // define Bob persona scenario('persona demo') { println cfg.userId // custom value from config Alice { println cfg.userId // custom value from config in Alice's context } Bob { println cfg.userId // custom value from config in Bob's context } } As we start using Personas for multiple tests and multiple files it makes sense to define Personas once and reference them in tests as needed. package personas // user defined package name/directory import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class Personas { // class name can be anything public static final def Admin = persona('Admin') public static final def Alice = persona('Alice') public static final def Bob = persona('Bob') } To use defined personas we leverage Java/Groovy static import: package basicScenarios import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* import static personas.Personas.* // import all available personas to be in scope scenario('persona demo') { println cfg.userId Alice { // Alice is taken from personas.Personas.* println cfg.userId } Bob { println cfg.userId } }</p>
</article>

<article>
<header><h1>Browser</h1></header>
<p>We looked at how to test REST and GraphQL based APIs. Now let's move on to testing Web UI. Before we jump into testing Game Store UI, we will do a classic test of Google Page.Our test will enter &quot;test&quot; value into the search box and, wait for the results to show up and pick a result based on a regular expression: scenario('basic browser interaction') { browser.open(&quot;https://google.com&quot;) $('input[title=&quot;Search&quot;]').setValue(&quot;test\n&quot;) // set value based on the underlying component $('h3').count.waitTo &gt;= 1 // explicit, simplified wait on condition $(&quot;h3&quot;).get(~/Speedtest.*Ookla/).click() // example of filter based on regular expression browser.url.full.should == ~/speedtest.net/ // full url assertion } As with REST and GraphQL, webtau console output captures all the actions that happen, and how much time each action took: basic browser interaction (browserBasics.groovy) preparing chrome WebDriver &gt; opening https://google.com . opened https://google.com (461ms) &gt; setting value test\n to by css input[title=&quot;Search&quot;] &gt; clearing by css input[title=&quot;Search&quot;] . cleared by css input[title=&quot;Search&quot;] (36ms) &gt; sending keys test\n to by css input[title=&quot;Search&quot;] . sent keys test\n to by css input[title=&quot;Search&quot;] (936ms) . set value test\n to by css input[title=&quot;Search&quot;] (1s 10ms) &gt; waiting to count of by css h3 to be greater than or equal to 1 . count of by css h3 greater than or equal 1 matches: count: actual: 15 &lt;java.lang.Integer&gt; expected: greater than or equal to 1 &lt;java.lang.Integer&gt; (29ms) &gt; clicking by css h3 , element(s) with regexp Speedtest.*Ookla . clicked by css h3 , element(s) with regexp Speedtest.*Ookla (774ms) &gt; expecting full page url of browser to equal pattern /speedtest.net/ . full page url of browser equals pattern /speedtest.net/ matches: full page url: actual string: https://www.speedtest.net/ expected pattern: speedtest.net (4ms) Note: Both passed and failed assertions are captured.</p>
</article>

<article>
<header><h1>Game Store UI</h1></header>
<p>The first Game Store page we are going to test is a landing page. It shows available games and let you filter based on text or price.We covered how to use http. layer to create new games. We can use that to prepare a setup for our UI test: package scenarios.gamestore import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* scenario('landing page') { http.post(&quot;/api/game&quot;, [id: &quot;g1&quot;, title: &quot;Slay The Spire&quot;, type: &quot;card rpg&quot;, priceUsd: 20]) // pre-create test data using HTTP http.post(&quot;/api/game&quot;, [id: &quot;g2&quot;, title: &quot;Civilization 6&quot;, type: &quot;strategy&quot;, priceUsd: 60]) http.post(&quot;/api/game&quot;, [id: &quot;g3&quot;, title: &quot;Doom&quot;, type: &quot;fps&quot;, priceUsd: 40]) browser.open(&quot;/&quot;) // open landing page, relying on url and/or browserUrl def titles = $('[class*=&quot;GamesList_title&quot;]') // define titles as page element selected by css titles.waitTo == ['Civilization 6', 'Doom', 'Slay The Spire'] // wait for games titles to show up and match our expectations http.delete(&quot;/api/game/g3&quot;) // delete a single game using HTTP titles.waitTo == ['Civilization 6', 'Slay The Spire'] // wait for UI to reflect changes } Let's test the filters: scenario('filter by text') { browser.reopen(&quot;/&quot;) $(&quot;#filter&quot;).setValue(&quot;civ&quot;) // use setValue abstraction to set value inside input box $('[class*=&quot;GamesList_title&quot;]').waitTo == ['Civilization 6'] // wait for changes to be reflected } scenario('filter by price') { browser.reopen(&quot;/&quot;) $(&quot;#below60&quot;).setValue(true) // use setValue abstraction to set value for a checkbox $('[class*=&quot;GamesList_title&quot;]').waitTo == ['Doom', 'Slay The Spire'] // wait for changes to be reflected } Note: setValue is used for both text input box and check box. Webtau will figure out what actions to perform based on the underlying form element.</p>
</article>

<article>
<header><h1>UI Page Object</h1></header>
<p>If you have experience in writing UI tests, you may have heard about https://martinfowler.com/bliki/PageObject.html Page Object pattern. Basic idea is to separate what user can see or do from technical details of how to simulate the actions or query the values.If we take a look at the code in our UI test we will see that details of how to locate elements on the UI are exposed. Any time we change id element or class names, we risk breaking our tests.Warning: Tests should not be broken if only implementation details has changed. $(&quot;#filter&quot;).setValue(&quot;civ&quot;) // exposing css selector to the test is going to haunt you later $('[class*=&quot;GamesList_title&quot;]').waitTo == ['Civilization 6'] // class based selection is more likely to become out of sync To implement page object in Webtau we will use a regular Java/Groovy/Kotlin class: package pages import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class LandingPage { def titles = $('[class*=&quot;GamesList_title&quot;]') def filterText = $(&quot;#filter&quot;) // lazy declaration for future usage, no actual attempt to find element is performed def filterBelow60 = $(&quot;#below60&quot;) def labelBelow60 = $(&quot;span&quot;).get('Below $60') // filters chaining is also lazy def adminMessage = $(&quot;#admin-message&quot;) def reopen() { browser.reopen(&quot;/&quot;) } } Since our page object class is stateless and elements declarations are lazy, we can precreate instances of all the page objects in one place: package pages class Pages { static final def maintenance = new MaintenancePage() // pre-creating stateless instances static final def login = new LoginPage() static final def landing = new LandingPage() // for all the pages our test suite needs to have access static final def userPreferences = new UserPreferencesPage() } package scenarios.gamestore import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* import static pages.Pages.* // import all the pages into test scope scenario('filter by text') { landing.reopen() // set value using input defined in the page object landing.filterText.setValue(&quot;last&quot;) landing.titles.waitTo == ['Last Of Us 2'] } scenario('filter by price') { landing.reopen() // set checkbox value using input defined in the page object landing.filterBelow60.setValue(true) landing.titles.waitTo == ['Assassin Creed Odyssey', 'Division 2', 'Hearthstone', 'Inside', 'Slay The Spire'] }</p>
</article>

<article>
<header><h1>WaitTo</h1></header>
<p>You saw waitTo in a couple of places already. Let's pause on the topic.Question: Why do we need waitTo and can we instead make should do the waiting?We could. However, semantics are important. I think it is important to distinct between an immediate result, and a result that becomes available over time.Are our users going to see the result right away? Is database going to have the result right away? Is command line going to print that line right away?Additionally waitTo is not specific for browser. layer. It can be used to wait on files content, console output, database data, etc. // waiting on query to finally return a value (eventual consistency) db.query(&quot;select * from games&quot;).waitTo contain([title: &quot;Slay The Spire&quot;]) // waiting of file content to contain a line fs.textContent(&quot;my-file.txt&quot;).waitTo contain('important line') def command = cli.runInBackground(&quot;admin-tool&quot;) login.login(&quot;myname&quot;, &quot;mypassword&quot;) // waiting on command line tool to print important message command.output.waitTo contain(&quot;&lt;myname&gt; logged in&quot;) Testing Is DocumentingTesting is Documenting is my moto. WaitTo semantics allow you to look at the test and get a better understanding of how system behaves. This is an example of a more subtle, more common definition of how tests can help you to understand the system.Later I will show you how to make tests help you with the actual documentation in a more explicit manner.</p>
</article>

<article>
<header><h1>Browser Explicit Auth</h1></header>
<p>Game Store have a page where users can update their user preferences.If we go to that page directly, we will be redirected to the login page instead.In order to test user preferences page, we have to choices:handle login explicitly handle login implicitly scenario('user preferences redirects to login') { userPreferences.open() // open user preferences page login.name.waitTo beVisible browser.url.ref.should == '/login' // but landed on login page login.login('uid-test', 'dummy-password') // explicitly enter user name and password userPreferences.userId.waitTo == 'uid-test' // after redirect we can see user preferences userPreferences.favoriteGenre.should == '' } package pages import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class UserPreferencesPage { def userId = $('#user-id') // user id to assert on def favoriteGenre = $('#favorite-genre') // genre to validate/set def saveButton = $('#save') def saveResultMessage = $('#save-result') def open() { browser.reopen(&quot;/#/user&quot;) } def save() { // exposed action - regular method saveButton.click() } } package pages import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class LoginPage { def name = $('#name') // name to wait on def password = $('#password') def loginButton = $('#login') void login(name, password) { // action to login with this.name.setValue(name) this.password.setValue(password) loginButton.click() } } Explicit login approach works well if we go the page once, and we know that we haven't performed login yet. If on the other hand we need to get to that page as part of other scenario, we may face the case where we have already logged-in, and the code that assumed logic redirection will fail.To fix that we will need to add additional if-else logic that may complicate things a bit.Alternatively we can use an implicit login with Personas.</p>
</article>

<article>
<header><h1>Browser Implicit Auth</h1></header>
<p>Browser Implicit Auth in also Persona based. scenario('implicit login with persona') { Alice { // In the Alice's context http.put('/api/user-preferences', [favoriteGenre: 'RPG']) // prepare data to assert on - another example of http/browser test combination userPreferences.open() // open user preferences userPreferences.userId.waitTo == 'uid-alice' // we expect user preferences screen, not the login screen userPreferences.favoriteGenre.should == 'RPG' // our assertion matches what we set using REST API } } Let's now update preferences through UI and validate them using REST API: scenario('change preferences through UI') { Bob { http.put('/api/user-preferences', [favoriteGenre: 'Sim']) } // Set Bob's preference via HTTP Alice { userPreferences.open() userPreferences.favoriteGenre.waitTo beVisible() // wait for UI to load data from REST endpoint userPreferences.favoriteGenre.setValue('CRPG') userPreferences.save() // save user preferences userPreferences.saveResultMessage.waitTo == 'Saved' // wait for visual clue to appear } Bob { // In Bob's context http.get('/api/user-preferences') { favoriteGenre.should == 'Sim' // Bob's preferences were not affected by UI } } Alice { // In Alice's context http.get('/api/user-preferences') { favoriteGenre.should == 'CRPG' // Genre is the one we set } } } To make implicit auth work we need to implement browserPageNavigationHandler . A handler that will be called for each page open event. package auth import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class BrowserOpenHandler { private static STORAGE_KEY = 'authToken' static void handleOpen(passedUrl, fullUrl, currentUrl) { // will be called for every page open def userId = cfg.userId // take user from config based on current persona if (!userId || browser.localStorage.getItem(STORAGE_KEY)) { // if no user or token is inside storage, we don't need to do anything return } browser.localStorage.setItem(STORAGE_KEY, generateToken(userId)) // set a new auth token generated based on current persona browser.reopen(fullUrl) // re-open original page } // generate token based on your auth system, dummy impl for the demo purposes only private static def generateToken(String userId) { return userId.bytes.encodeBase64().toString() } } Note: Game Store UI code uses local storage to manage auth token. In your app it could be session storage or cookies. browserPageNavigationHandler = BrowserOpenHandler.&amp;handleOpen // implicit page open handler userId = '' // explicitly set default userId to be an empty string personas { Alice { userId = 'uid-alice' // Alice's system specific user id } Bob { userId = 'uid-bob' // Bob's system specific user id } } Question: How do we maintain different localStorage for different Personas? Webtau maintains a browser per persona . In the examples above we have a total of two browsers during test run:Default browser Alice's browser</p>
</article>

<article>
<header><h1>Browser WebSocket</h1></header>
<p>Now that we know how to use Persona to manage multiple browsers, we can write a test for the last part of Game Store UI - admin page to send messages to visitors.Admin page allows to send a message to all visitors via WebSocket.In order to test this we will need two browsers: one to send a message and another to receive a websocket event.Let's start with defining a page object for the new page: package pages import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class MaintenancePage { def message = $('#message') def sendMessage = $('button').get('send message') def reopen() { browser.reopen(&quot;/#/admin&quot;) } } package scenarios.gamestore import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* // single convenient import for IDE auto complete import static pages.Pages.* // convenient access to all page objects import static personas.Personas.* // convenient access to all Personas scenario('sending admin message') { landing.reopen() // open landing page in a default browser def message = 'Shop is going to be closed for maintenance' Admin { maintenance.reopen() // open maintenance page in Admin's browser maintenance.message.setValue(message) maintenance.sendMessage.click() // send notification message } landing.adminMessage.waitTo == message // in the default browser, wait for the message to arrive }</p>
</article>

<article>
<header><h1>Database</h1></header>
<p>Another layer to explore is Database. Database layer can be used to prepare test data. It can also be used to validate data persistence after REST/GraphQL API calls.Warning: Database layer is often considered to be implementation details, and most of your tests should not use it directly. However, it can be useful to validate that REST POST method did modify data in the database and didn't persist data in cache only. scenario('http post and db list games') { db.update(&quot;delete from Game&quot;) // wipe out table http.post(&quot;/api/game&quot;, [id: &quot;g1&quot;, title: &quot;Slay The Spire&quot;, type: &quot;card rpg&quot;, priceUsd: 20]) // create two games using HTTP http.post(&quot;/api/game&quot;, [id: &quot;g2&quot;, title: &quot;Civilization 6&quot;, type: &quot;strategy&quot;, priceUsd: 60]) def GAME = db.table(&quot;GAME&quot;) GAME.should == [&quot;*ID&quot; | &quot;TITLE&quot;] { // make sure DB reflects changes __________________________ &quot;g1&quot; | &quot;Slay The Spire&quot; &quot;g2&quot; | &quot;Civilization 6&quot;} } scenario('db write and http list games') { db.update(&quot;delete from Game&quot;) def GAME = db.table(&quot;GAME&quot;) // populate GAME table with two rows GAME &lt;&lt; [&quot;ID&quot; | &quot;TITLE&quot; | &quot;TYPE&quot; | &quot;PRICE_USD&quot;] { ____________________________________________________ &quot;g1&quot; | &quot;Slay The Spire&quot; | &quot;card rpg&quot; | 20 &quot;g2&quot; | &quot;Civilization 6&quot; | &quot;strategy&quot; | 60 } http.get(&quot;/api/game&quot;) { // expect body to contain a list of two games body.should == [ &quot;*id&quot; | &quot;title&quot; ] { ___________________________ &quot;g2&quot; | &quot;Civilization 6&quot; &quot;g1&quot; | &quot;Slay The Spire&quot; } } }</p>
</article>

<article>
<header><h1>CLI Command</h1></header>
<p>Command line interface is our final layer to test. Before we test admin app, let's see how cli. works on a simple command: cli.run(&quot;ls -l&quot;) cli.run(&quot;ls -l&quot;) { output.should contain(&quot;webtau.cfg.groovy&quot;) } total 1032 drwxr-xr-x 4 mykolagolubyev staff 128 Oct 27 16:39 auth drwxr-xr-x 13 mykolagolubyev staff 416 Oct 27 10:21 basicScenarios drwxr-xr-x 4 mykolagolubyev staff 128 Oct 27 10:21 clicommands drwxr-xr-x 3 mykolagolubyev staff 96 Oct 15 14:58 listeners drwxr-xr-x 8 mykolagolubyev staff 256 Oct 31 23:01 pages drwxr-xr-x 3 mykolagolubyev staff 96 Oct 31 22:59 personas drwxr-xr-x 8 mykolagolubyev staff 256 Oct 27 10:21 scenarios drwxr-xr-x 3 mykolagolubyev staff 96 Jul 29 13:24 test drwxr-xr-x 3 mykolagolubyev staff 96 Oct 23 20:21 utils -rw-r--r-- 1 mykolagolubyev staff 1071 Oct 31 20:38 webtau.cfg.groovy -rw-r--r-- 1 mykolagolubyev staff 500422 Oct 31 23:20 webtau.report.html Our admin CLI tool works similar ls and list games available in the system: List of games 6391a57f-7b59-4997-8459-1a8f88d3c0ab Slay The Spire card rpg 20.0 20cb8232-6515-4c2d-9046-acc990ab4c2d Civilization 6 strategy 60.0 We still develop the tool and it is not available in PATH yet, so we will need to use a relative path to run it. Exposing the path to tests will make our tests brittle in the similar way how exposing UI elements definition does: any time we change the tool location we will have to change tests using the tool.Similar to UI Page Object idea, we declare CLI tools our tests need access to in a separate file/class: package clicommands import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* class CliCommands { static final def adminTool = cli.command( // lazy declaration of our CLI command &quot;java -jar ../../../../game-store-cli/target/admin-tool-jar-with-dependencies.jar&quot;) // command line location is subject to change and should not be exposed to a test } package scenarios.gamestore import static clicommands.CliCommands.* // convenient access to all declared command line tools import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* scenario('list games using CLI') { // cleaning up DB db.update(&quot;delete from GAME&quot;) // run our command line adminTool.run { output.should contain(&quot;List of games&quot;) // expect a title to be present, and nothing else output.numberOfLines.should == 1 } http.post(&quot;/api/game&quot;, [title: &quot;Slay The Spire&quot;, type: &quot;card rpg&quot;, priceUsd: 20]) // pre-create data we need for the test using http layer http.post(&quot;/api/game&quot;, [title: &quot;Civilization 6&quot;, type: &quot;strategy&quot;, priceUsd: 60]) adminTool.run { output.should contain(&quot;Slay The Spire&quot;) // make sure output contains games we created output.should contain(&quot;Civilization 6&quot;) } }</p>
</article>

<article>
<header><h1>TableData</h1></header>
<p>We have seen TableData usage when we worked with Database and when we validated complex REST API output. Let's take a closer look at it. TableData is a core webtau data type. Think of it as a list of maps with extra functionality. You can assign TableData to a variable, pass it around, return from functions and use for assertions. Data is available at runtime, and it is not a compile-time construct.Here is an example of usage of extra TableData features to generate test data: scenario('table data demo') { def increment = cell.above + 1 // create increment cell function to auto increase value def tableData = [&quot;id&quot; | &quot;name&quot; | &quot;score&quot; | &quot;type&quot; | &quot;disabled&quot;] { ____________________________________________________________________________ cell.guid | &quot;A&quot; | 100 | &quot;T0R&quot; | false // cell.guid generates guid cell.guid | &quot;B&quot; | cell.above | &quot;MBR&quot; | true // cell.above reuses value from the row above cell.guid | &quot;C&quot; | increment | permute(&quot;PO&quot;, &quot;AC&quot;) | permute(true, false) } // permute generates multiple rows based on the values passed println(&quot;table data:&quot;) println(tableData) println(tableData.collect { it.score }) // standard collection operations are available on table data } table data demo (tableDataDemo.groovy) table data: :id |name|score|type |disabled: .______________________________________.____._____._____.________. |&quot;f982944c-3799-4738-b169-dfd85d588599&quot;|&quot;A&quot; |100 |&quot;T0R&quot;|false | .______________________________________.____._____._____.________| |&quot;61a70270-afe4-4180-80d2-d5ab1b561758&quot;|&quot;B&quot; |100 |&quot;MBR&quot;|true | .______________________________________.____._____._____.________| |&quot;e7cf8880-927d-4142-80db-2987c34b631e&quot;|&quot;C&quot; |101 |&quot;PO&quot; |true | .______________________________________.____._____._____.________| |&quot;93033ad0-9d1e-4951-bad6-b76257df4a0c&quot;|&quot;C&quot; |102 |&quot;AC&quot; |true | .______________________________________.____._____._____.________| |&quot;765b44c2-b0f7-4289-8641-425b56183778&quot;|&quot;C&quot; |103 |&quot;PO&quot; |false | .______________________________________.____._____._____.________| |&quot;e003ace6-3d83-4861-a845-2adbfb1fcc8d&quot;|&quot;C&quot; |104 |&quot;AC&quot; |false | .______________________________________.____._____._____.________| [100, 100, 101, 102, 103, 104]</p>
</article>

<article>
<header><h1>Can I Use TableData With JUnit?</h1></header>
<p>It is worth noting that TableData is not specific to Groovy command line runner. In fact it can be used for example as JUnit5 test factory: package com.example.junit5 import org.junit.jupiter.api.TestFactory class DynamicTestsGroovyTest { @TestFactory // Junit5 test factory that expects Stream&lt;DynamicTest&gt; def &quot;test factory example&quot;() { [&quot;price&quot; | &quot;quantity&quot; | &quot;outcome&quot;] { ___________________________________ 10 | 30 | 300 -10 | 30 | -300 }.test { // test is a what generates DynamicTest from each row PriceCalculator.calculate(price, quantity).should == outcome } } } Moreover, TableData is not specific to Groovy and you can use Java syntax to define an instance: package com.example.junit5; import org.junit.jupiter.api.DynamicTest; import org.junit.jupiter.api.TestFactory; import org.testingisdocumenting.webtau.data.table.TableData; import org.testingisdocumenting.webtau.junit5.DynamicTests; import java.util.stream.Stream; import static org.testingisdocumenting.webtau.WebTauCore.*; // convenient single import for unit tests class DynamicTestsJavaTest { TableData useCases = table(&quot;price&quot;, &quot;quantity&quot;, &quot;outcome&quot;, // java table definition ______________________________, 10 , 30, 300, -10 , 30, -300); @TestFactory public Stream&lt;DynamicTest&gt; testFactoryExample() { return DynamicTests.fromTable(useCases, r -&gt; { // generate DynamicTest per row int price = r.get(&quot;price&quot;); int quantity = r.get(&quot;quantity&quot;); int outcome = r.get(&quot;outcome&quot;); actual(PriceCalculator.calculate(price, quantity)).should(equal(outcome)); }); } }</p>
</article>

<article>
<header><h1>Can I Use The Rest With JUnit?</h1></header>
<p>Since we are talking about JUnit and Java, let me show you how to write a REST API test using JUnit5 and Java syntax: package com.example.junit5; import org.junit.jupiter.api.Test; import org.testingisdocumenting.webtau.junit5.WebTau; import java.util.Map; import static org.testingisdocumenting.webtau.WebTauDsl.*; // convenient import for Java @WebTau // optional annotation to include this test into web report public class PostGetJavaTest { @Test public void registerNewGame() { Map&lt;String, Object&gt; payload = aMapOf( // define payload as a map &quot;id&quot;, &quot;g1&quot;, &quot;title&quot;, &quot;Slay The Spire&quot;, &quot;type&quot;, &quot;card rpg&quot;, &quot;priceUsd&quot;, 20); http.post(&quot;/api/game&quot;, payload); // same post as in Groovy http.get(&quot;/api/game/g1&quot;, (header, body) -&gt; { body.get(&quot;title&quot;).should(equal(&quot;Slay The Spire&quot;)); // validating title field in the response }); } } In case of JUnit runner, webtau reads config values from webtau.properties resource file: url=http://localhost:8080</p>
</article>

<article>
<header><h1>Reporting</h1></header>
<p>As I mentioned at the beginning, webtau captures a lot of information. Information is printed to the console, but also stored in a rich HTML report.Generated report is a self-contained HTML file that can be emailed, slacked or copied to a network drive. You don't need to have a server to look at the report. Open it in a browser, and you will get an interactive mini app.Report Summary page consist ofTests Runtime - shows overall time spend Tests success ratio - how many failed vs passed HTTP Coverage - how many REST API operations are covered (webtau uses optional Open API spec url to discover all the operations) Tests run Ratio - how many skipped vs ran HTTP calls time - high level stats on HTTP based APIs Let's click on ( 6 ) to get more details about skipped operations:Report switched from Tests view to HTTP Calls view ( 1 ). You can see the list of operations we yet to test on the left ( 2 ). Number of items on the left matches the number in the summary card ( 3 ). We can use panel at the bottom ( 4 ) to switch between skipped, total, passed operations or tests.Let's navigate from Summary tab to Overal HTTP Performance tab. The screen shows high level picture of how performant our server is under test load. While it is not a true performance test, it may give you an initial glance into things that may need a closer look.HTTP Operations Performance tab provides a performance information based on Open API defined operations.Let's get back to tests view ( 1 ) and select a test ( 2 ). First screen we are going to see is a test Summary ( 3 ) with high level information on time taken.If a test performed any HTTP calls, you going to see the HTTP Calls tab ( 1 ). It contains every HTTP call performed with captured request, response and assertions ( 2 and 3 ) information.If a test performed any CLI calls, you going to see the CLI Calls tab ( 1 ). It contains every CLI call performed with captured command, output and assertions ( 2 ) information.Every test also has Steps tab ( 1 ) that contains every step test performed, time it took, and what Persona if any performed the step ( 2 and 3 )</p>
</article>

<article>
<header><h1>REPL</h1></header>
<p>REPL stands for read-eval-print-loop. It is an interactive computer programming environment that helps with prototyping.You may have already used REPL if you usedJupyter Notebook iPython R MatLab webtau:000&gt; 2 + 2 ===&gt; 4 webtau:000&gt; a = 5 ===&gt; 5 webtau:000&gt; a + 3 ===&gt; 8 Question: Why are we talking about REPL in the context of end to end testing?We want to have a fast feedback loop.Browser, Servers, DB setup takes time Preserving context End to end tests - slow feedback REPL - speedup feedback loop The faster feedback the happier you are</p>
</article>

<article>
<header><h1>REPL Browser</h1></header>
<p>Writing UI tests can be time-consuming. One of the reason is it takes time to open a browser, run your test, add an extra line to the test, repeat.Instead we can run webtau in repl mode like this webtau repl after that we can execute one command at a time, preserving context webtau:000&gt; browser.open(&quot;https://google.com&quot;) preparing chrome WebDriver &gt; opening https://google.com . opened https://google.com (459ms) webtau:000&gt; $('input[title=&quot;Search&quot;]') element is found: by css input[title=&quot;Search&quot;] getText(): getUnderlyingValue(): webtau:000&gt; $('input[title=&quot;Search&quot;]').setValue(&quot;test\n&quot;) &gt; setting value test\n to by css input[title=&quot;Search&quot;] &gt; clearing by css input[title=&quot;Search&quot;] . cleared by css input[title=&quot;Search&quot;] (37ms) &gt; sending keys test\n to by css input[title=&quot;Search&quot;] . sent keys test\n to by css input[title=&quot;Search&quot;] (1s 987ms) . set value test\n to by css input[title=&quot;Search&quot;] (2s 45ms) webtau:000&gt; $('input[title=&quot;Search&quot;]') element is found: by css input[title=&quot;Search&quot;] getText(): getUnderlyingValue(): test webtau:000&gt; $('h3') element is found: by css h3 getText(): Speedtest by Ookla - The Global Broadband Speed Test getUnderlyingValue(): Speedtest by Ookla - The Global Broadband Speed Test count: 15 webtau:000&gt; $('h3').count.waitTo &gt;= 0 &gt; waiting to count of by css h3 to be greater than or equal to 0 . count of by css h3 greater than or equal 0 matches: count: actual: 15 &lt;java.lang.Integer&gt; expected: greater than or equal to 0 &lt;java.lang.Integer&gt; (7ms)</p>
</article>

<article>
<header><h1>REPL Database</h1></header>
<p>Database layer can be used to semi-automatically validate state of your system during experimentation. Or it can be used to quickly wipe or setup the data. I personally use it during active development to iterate faster. webtau:000&gt; db.query(&quot;select * from Game&quot;) &gt; running DB query select * from Game on primary-db . ran DB query select * from Game on primary-db (29ms) ID , PRICE_USD, TITLE , TYPE &quot;g1&quot;, 20.00, &quot;Slay The Spire&quot;, &quot;card rpg&quot; &quot;g2&quot;, 40.00, &quot;Doom&quot; , &quot;fps&quot;</p>
</article>

<article>
<header><h1>REPL Test Selection</h1></header>
<p>The true power of webtau REPL mode comes from combining Test runs and experimentation in one go. We can run webtau in repl mode and at the same time pass the test files we want to work with: webtau scenarios/gamestore/adminCliTool.groovy scenarios/gamestore/userPreferencesRest.groovy scenarios/gamestore/userPreferencesGraphQL.groovy scenarios/gamestore/userPreferencesUi.groovy repl webtau:000&gt; ls Test files: 0 scenarios/gamestore/adminCliTool.groovy 1 scenarios/gamestore/userPreferencesRest.groovy 2 scenarios/gamestore/userPreferencesGraphQL.groovy 3 scenarios/gamestore/userPreferencesUi.groovy Once you list all test files, you can select one by https://testingisdocumenting.org/webtau/REPL/test-runs#test-file-selection either index or text webtau:000&gt; s &quot;userPreferencesRest&quot; Test scenarios of scenarios/gamestore/userPreferencesRest.groovy: 0 save preferences without auth 1 save preferences with explicit auth 2 save preferences with personas auth 3 read preferences with personas auth After test file selection, you can run one or more scenarios on demand. webtau:000&gt; r &quot;save preferences with personas auth&quot; running: scenarios/gamestore/userPreferencesRest.groovy save preferences with personas auth save preferences with personas auth (userPreferencesRest.groovy) &gt; Alice executing HTTP PUT http://localhost:8080/api/user-preferences request (application/json): { &quot;favoriteGenre&quot;: &quot;RPG&quot; } . Alice body.userId equals &quot;uid-alice&quot; matches: body.userId: actual: &quot;uid-alice&quot; &lt;java.lang.String&gt; expected: &quot;uid-alice&quot; &lt;java.lang.String&gt; (18ms) . Alice body.favoriteGenre equals &quot;RPG&quot; matches: body.favoriteGenre: actual: &quot;RPG&quot; &lt;java.lang.String&gt; expected: &quot;RPG&quot; &lt;java.lang.String&gt; (0ms) . Alice header.statusCode equals 200 matches: header.statusCode: actual: 200 &lt;java.lang.Integer&gt; expected: 200 &lt;java.lang.Integer&gt; (1ms) &gt; Alice validating request and response . Alice validated request and response (149ms) response (application/json): { &quot;userId&quot;: __&quot;uid-alice&quot;__, &quot;favoriteGenre&quot;: __&quot;RPG&quot;__ } . Alice executed HTTP PUT http://localhost:8080/api/user-preferences (320ms) &gt; Bob executing HTTP PUT http://localhost:8080/api/user-preferences When I write tests, I keep re-running ( r ) a current test under development, then experiment with a few lines in REPL mode, do some checks, update the test file and re-run it ( r ). Webtau will reload test file and pickup your changes.After each test run, context is preserved, browser is open in the last location, DB is up to date, and REST/GraphQL APIs are primed.Here is an example of running a db. query after a test run: webtau:000&gt; db.query(&quot;select * from user_preferences&quot;) &gt; running DB query select * from user_preferences on primary-db . ran DB query select * from user_preferences on primary-db (30ms) USER_ID , FAVORITE_GENRE &quot;user-a&quot; , &quot;RPG&quot; &quot;uid-alice&quot;, &quot;RPG&quot; &quot;uid-bob&quot; , &quot;Strategy&quot;</p>
</article>

<article>
<header><h1>Testing is Documenting</h1></header>
<p>When we document things, we try them out and make sure they work as intended. When we test things, we follow happy paths and edge cases.Happy path tests often cover what our users will do. Happy path tests also often match the things we document.Documentation is hard: Mostly manual labor Often becomes outdated Question: How do we make documentation easier to write and maintain?Artifacts captureWe already have things in our codebase that we can use to help with our product documentation. Example code snippets, GraphQL schema files, basic config files.By writing happy path tests we can add a few more to the list:CLI Outputs HTTP responses Screenshots The major part of this content was generated by running testsWebtau console outputs your saw, the REST/GraphQL API response, Game Store and Webtau Report screenshots, all of it was automatially generated by running tests.</p>
</article>

<article>
<header><h1>Capturing Test Artifacts</h1></header>
<p>When I was showing your snippets of code before I was hidding some code from your. Let's take a look. scenario('db write and http list games') { db.update(&quot;delete from Game&quot;) def GAME = db.table(&quot;GAME&quot;) GAME &lt;&lt; [&quot;ID&quot; | &quot;TITLE&quot; | &quot;TYPE&quot; | &quot;PRICE_USD&quot;] { ____________________________________________________ &quot;g1&quot; | &quot;Slay The Spire&quot; | &quot;card rpg&quot; | 20 &quot;g2&quot; | &quot;Civilization 6&quot; | &quot;strategy&quot; | 60 } http.get(&quot;/api/game&quot;) { body.should == [ &quot;*id&quot; | &quot;title&quot; ] { ___________________________ &quot;g2&quot; | &quot;Civilization 6&quot; &quot;g1&quot; | &quot;Slay The Spire&quot; } } http.doc.capture(&quot;game-store-list-after-db&quot;) } http.doc.capture generates a directory with captured response, request, url, assertions, etc /api/game [ { &quot;id&quot; : &quot;g1&quot;, &quot;title&quot; : &quot;Slay The Spire&quot;, &quot;type&quot; : &quot;card rpg&quot;, &quot;priceUsd&quot; : 20.0 }, { &quot;id&quot; : &quot;g2&quot;, &quot;title&quot; : &quot;Civilization 6&quot;, &quot;type&quot; : &quot;strategy&quot;, &quot;priceUsd&quot; : 60.0 } ] [&quot;root[0].id&quot;,&quot;root[0].title&quot;,&quot;root[1].id&quot;,&quot;root[1].title&quot;] To capture screenshots webtau has browser.doc.capture scenario('filter by price') { landing.reopen() landing.filterBelow60.setValue(true) landing.titles.waitTo == ['Assassin Creed Odyssey', 'Division 2', 'Hearthstone', 'Inside', 'Slay The Spire'] browser.doc.withAnnotations( browser.doc.badge(landing.filterText).toTheRight(), browser.doc.badge(landing.labelBelow60).toTheRight()) .capture('admin-ui-filter') } In addition to the screenshot .png file webtau also captures annotations placement and type: { &quot;shapes&quot; : [ { &quot;id&quot; : &quot;circle1&quot;, &quot;type&quot; : &quot;circle&quot;, &quot;text&quot; : &quot;1&quot;, &quot;color&quot; : &quot;a&quot;, &quot;x&quot; : 224, &quot;y&quot; : 88, &quot;r&quot; : 15 }, { &quot;id&quot; : &quot;circle2&quot;, &quot;type&quot; : &quot;circle&quot;, &quot;text&quot; : &quot;2&quot;, &quot;color&quot; : &quot;a&quot;, &quot;x&quot; : 345, &quot;y&quot; : 88, &quot;r&quot; : 15 } ], &quot;pixelRatio&quot; : 2 } In case of CLI cli.doc.capture captures the command that was run, its output and assertions performed package scenarios.gamestore import static org.testingisdocumenting.webtau.WebTauGroovyDsl.* scenario('list games using CLI') { db.update(&quot;delete from GAME&quot;) adminTool.run { output.should contain(&quot;List of games&quot;) output.numberOfLines.should == 1 } http.post(&quot;/api/game&quot;, [title: &quot;Civilization 6&quot;, type: &quot;strategy&quot;, priceUsd: 60]) adminTool.run { output.should contain(&quot;Civilization 6&quot;) } cli.doc.capture(&quot;list-games-cli&quot;) } java -jar ../../../../game-store-cli/target/admin-tool-jar-with-dependencies.jar List of games 6391a57f-7b59-4997-8459-1a8f88d3c0ab Slay The Spire card rpg 20.0 20cb8232-6515-4c2d-9046-acc990ab4c2d Civilization 6 strategy 60.0</p>
</article>

<article>
<header><h1>Example of Generated Documentation</h1></header>
<p>I used the captured information to generate the content of this blog/presentation. At my work I use captured artifacts to produce user guides. This approach makes guides to be always up-to date and validated.Here is an example of Game Store manual created with captured artifacts and https://testingisdocumenting.org/znai/ Znai documentation system.</p>
</article>

<article>
<header><h1>Summary</h1></header>
<p>We tested Game Store on multiple layers, using one layer to set-up and re-inforce tests on the other layers. We used consistent matchers and concepts like should , waitTo , Persona across layers. We saw how each step and assertions is captured by webtau and written to console and rich HTML report. We saw how REPL can improve feedback loop and make you write tests faster. We saw how writing tests can generate artifacts to help you with writing User facing documentation.</p>
</article>

<article>
<header><h1>To Get Started</h1></header>
<p>WebTau - GitHub: https://github.com/testingisdocumenting/webtau https://github.com/testingisdocumenting/webtau WebTau - User Guide: https://testingisdocumenting.org/webtau https://testingisdocumenting.org/webtauZnai - Github: https://github.com/testingisdocumenting/znai https://github.com/testingisdocumenting/znai Znai - User Guide: https://testingisdocumenting.org/znai https://testingisdocumenting.org/znai</p>
</article>
</section>
</div>
<script type="text/javascript" src="/blog/toc.js"></script>
<script type="text/javascript" src="/blog/assets.js"></script>
<script type="text/javascript" src="/blog/static/main.js"></script>
<script type="text/javascript" src="/blog/static/blog-bundle.js"></script>
<script type="text/javascript" src="/blog/tracking.js"></script>
<script type="text/javascript" src="/blog/search-index.js"></script>
<script>
document.getElementById('znai').innerHTML = '';
ReactDOM.render(React.createElement(Documentation, {
  "docMeta" : {
    "viewOn" : {
      "title" : "Edit on GitHub",
      "link" : "https://github.com/testingisdocumenting/blog/blob/master/blog-content"
    },
    "id" : "blog",
    "title" : "Testing Is Documenting",
    "type" : "Blog",
    "previewEnabled" : false
  },
  "page" : {
    "type" : "Page",
    "content" : [ {
      "title" : "WebTau",
      "id" : "webtau",
      "type" : "Section",
      "content" : [ {
        "type" : "BlockQuote",
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "WebTau stands for Web Tests Automation. An open source tool, API, and a framework designed to",
            "type" : "SimpleText"
          }, {
            "type" : "SoftLineBreak"
          }, {
            "text" : "simplify testing on multiple levels.",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "What do I mean by multiple levels? Apps I develop often have these layers:",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationBulletListType" : "RevealBoxes",
        "type" : "Meta"
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "REST/GraphQL API",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Web UI",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Command Line",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Database",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "When I write end-to-end tests I test on one layer, and validate on the other.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "I write a test for a command line tool and validate that CLI updates REST resource.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "I write a test for Web UI and use GraphQL API to set up the initial data.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Game Store",
      "id" : "game-store",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We are going to test Game Store product. It has Web UI where you can see what games are available.",
          "type" : "SimpleText"
        } ]
      }, {
        "fit" : true,
        "imageSrc" : "/blog/game-store-main-page.png",
        "timestamp" : 1604503430959,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 1354.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "It has CLI tool to help admins to manage the product.",
          "type" : "SimpleText"
        } ]
      }, {
        "command" : "gs-admin list",
        "paramsToHighlight" : [ ],
        "meta" : {
          "stickySlide" : "top 20%"
        },
        "type" : "CliCommand"
      }, {
        "title" : "admin tool cli output",
        "lines" : [ "\u001B[36mList of games\u001B[0m", "\u001B[35mg1 \u001B[33m        Slay The Spire \u001B[32m       card rpg \u001B[33m20.0\u001B[0m", "\u001B[35mg2 \u001B[33m        Civilization 6 \u001B[32m       strategy \u001B[33m60.0\u001B[0m", "\u001B[35mg3 \u001B[33m                  Doom \u001B[32m            fps \u001B[33m60.0\u001B[0m", "\u001B[35mg4 \u001B[33m          Last Of Us 2 \u001B[32madventure drama \u001B[33m60.0\u001B[0m", "\u001B[35mg5 \u001B[33m                Inside \u001B[32m      adventure \u001B[33m10.0\u001B[0m", "\u001B[35mg6 \u001B[33m           Hearthstone \u001B[32m           card \u001B[33m 0.0\u001B[0m", "\u001B[35mg7 \u001B[33m            Division 2 \u001B[32m    shooter rpg \u001B[33m30.0\u001B[0m", "\u001B[35mg8 \u001B[33mAssassin Creed Odyssey \u001B[32m            rpg \u001B[33m40.0\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "It has GraphQL and REST API to manage data.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "def query = '''\nquery {\n  game(id: \"g1\") {\n    title\n    type\n  }\n}\n'''",
        "title" : "GraphQL query",
        "startLine" : "query-definition-start",
        "endLine" : "query-definition-end",
        "excludeStartEnd" : true,
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "response",
        "data" : {
          "data" : {
            "game" : {
              "title" : "Slay The Spire",
              "type" : "card rpg"
            }
          }
        },
        "paths" : [ ],
        "type" : "Json"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Game Store product puts all the data into a database.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Below we are going to see how webtau lets you seamlessly test on different layers and use other layers to help with data validation.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "WebTau Introduction",
      "id" : "webtau-introduction",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Before writing a test for Game Store, we are going to use ",
          "type" : "SimpleText"
        }, {
          "url" : "https://jsonplaceholder.typicode.com/",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "JSON Placeholder",
            "type" : "SimpleText"
          } ]
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "website to demo basic ",
          "type" : "SimpleText"
        }, {
          "code" : "webtau",
          "type" : "InlinedCode"
        }, {
          "text" : " parts.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Our goal is to get and validate a response from this end point:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "txt",
        "snippet" : "https://jsonplaceholder.typicode.com/todos/1",
        "title" : "Target API",
        "meta" : {
          "stickySlide" : "top 20%"
        },
        "type" : "Snippet"
      }, {
        "title" : "Response",
        "pathsFile" : "basic-http-invocation/paths.json",
        "meta" : {
          "stickySlide" : "left"
        },
        "data" : {
          "userId" : 1,
          "id" : 1,
          "title" : "delectus aut autem",
          "completed" : false
        },
        "paths" : [ "root.title", "root.completed" ],
        "type" : "Json"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In webtau use ",
          "type" : "SimpleText"
        }, {
          "code" : "scenario",
          "type" : "InlinedCode"
        }, {
          "text" : " to define a test. Let's create a file and define our first scenario:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('basic http invocation') {\n    http.get('https://jsonplaceholder.typicode.com/todos/1') {\n        body.title.should == 'delectus aut autem' // automatic mapping of a field name to a JSON response\n        completed.should == false // specifying body is optional\n    }\n}",
        "title" : "httpBasics.groovy",
        "startLine" : "basic-http-invocation",
        "endLine" : "basic-http-invocation-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "http.doc",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Note: Most of the time we are going to use webtau as both API and command line runner. You can use ",
          "type" : "SimpleText"
        }, {
          "code" : "webtau",
          "type" : "InlinedCode"
        }, {
          "text" : " with",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "code" : "JUnit5",
          "type" : "InlinedCode"
        }, {
          "text" : " and ",
          "type" : "SimpleText"
        }, {
          "code" : "JUnit4",
          "type" : "InlinedCode"
        }, {
          "text" : " and pure Java if you prefer.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To run a test, assuming ",
          "type" : "SimpleText"
        }, {
          "code" : "webtau",
          "type" : "InlinedCode"
        }, {
          "text" : " is in ",
          "type" : "SimpleText"
        }, {
          "code" : "PATH",
          "type" : "InlinedCode"
        }, {
          "text" : ":",
          "type" : "SimpleText"
        } ]
      }, {
        "command" : "webtau httpBasics.groovy",
        "paramsToHighlight" : [ ],
        "meta" : {
          "stickySlide" : "top 15%"
        },
        "type" : "CliCommand"
      }, {
        "title" : "Execution Output",
        "startLine" : "basic http invocation",
        "endLine" : "executed HTTP GET",
        "highlight" : [ 2, 12, 21 ],
        "lines" : [ "\u001B[34mbasic http invocation \u001B[35m(httpBasics.groovy)\u001B[0m", "\u001B[33m> \u001B[34mexecuting HTTP GET \u001B[35mhttps://jsonplaceholder.typicode.com/todos/1\u001B[0m", "  \u001B[32m. \u001B[0m\u001B[1mbody.title \u001B[32mequals \"delectus aut autem\"", "      matches:", "      ", "      body.title:   actual: \"delectus aut autem\" <java.lang.String>", "                  expected: \"delectus aut autem\" <java.lang.String>\u001B[33m (\u001B[32m36ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[0m\u001B[1mbody.completed \u001B[32mequals false", "      matches:", "      ", "      body.completed:   actual: false <java.lang.Boolean>", "                      expected: false <java.lang.Boolean>\u001B[33m (\u001B[32m2ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[0m\u001B[1mheader.statusCode \u001B[32mequals 200", "      matches:", "      ", "      header.statusCode:   actual: 200 <java.lang.Integer>", "                         expected: 200 <java.lang.Integer>\u001B[33m (\u001B[32m0ms\u001B[33m)\u001B[0m", "\u001B[33mresponse\u001B[36m (application/json; charset=utf-8):\u001B[0m", "\u001B[33m{\u001B[0m", "  \u001B[35m\"userId\": \u001B[36m1\u001B[33m,\u001B[0m", "  \u001B[35m\"id\": \u001B[36m1\u001B[33m,\u001B[0m", "  \u001B[35m\"title\": \u001B[32m\u001B[1m\u001B[32m__\"delectus aut autem\"__\u001B[33m,\u001B[0m", "  \u001B[35m\"completed\": \u001B[36m\u001B[1m\u001B[32m__false__\u001B[0m", "\u001B[33m}\u001B[0m", "\u001B[32m. \u001B[34mexecuted HTTP GET \u001B[35mhttps://jsonplaceholder.typicode.com/todos/1\u001B[33m (\u001B[32m317ms\u001B[33m)\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Webtau captures everything that happens in a test:",
          "type" : "SimpleText"
        } ]
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "commands there were ran",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "assertions that were made (both passed and failed)",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "values that were checked (",
              "type" : "SimpleText"
            }, {
              "code" : "__",
              "type" : "InlinedCode"
            }, {
              "text" : " in the console output)",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "All the captured data is available after test run inside a rich html report that we are going to look at later.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Basic Configuration",
      "id" : "basic-configuration",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To avoid writing full url in our tests let's define a base url for our service, UI and define an additional environment:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "url = \"http://localhost:8080\" // base url for all http and browser requests\nbrowserUrl = \"http://localhost:3000\" // base url for browser open commands. Overrides url above if both are present\nbrowserId = \"firefox\" // specifying browser to use for browser based operations\n\nenvironments {\n    dev { // optional overrides for the configs for dev environment\n        url = \"http://dev-server:8080\"\n        browserUrl = \"http://dev-server:8080\"\n    }\n}",
        "title" : "webtau.cfg.groovy",
        "commentsType" : "inline",
        "excludeRegexp" : "package",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('implicit config usage') {\n    http.post(\"/relative-url\") // implicit usage of core url config value\n    browser.open(\"/test\") // implicit usage of browser url and browser id\n}",
        "title" : "config access",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "top 70"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "You can override config values using CLI params. Use ",
          "type" : "SimpleText"
        }, {
          "code" : "--env=<value>",
          "type" : "InlinedCode"
        }, {
          "text" : " to select an environment, i.e. a different set of config values:",
          "type" : "SimpleText"
        } ]
      }, {
        "command" : "webtau scenarios/* --env=dev --url=http://override-value --browserId=chrome",
        "paramsToHighlight" : [ "dev" ],
        "type" : "CliCommand"
      } ]
    }, {
      "title" : "Game Store REST API",
      "id" : "game-store-rest-api",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's test Game Store API to register and check a game by id.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "txt",
        "snippet" : "http://localhost:8080/api/game",
        "title" : "End-point to create a game",
        "meta" : {
          "stickySlide" : "top 20%"
        },
        "type" : "Snippet"
      }, {
        "title" : "Register a new game and check it after",
        "meta" : {
          "stickySlide" : "left 30%"
        },
        "data" : {
          "id" : "g1",
          "title" : "Slay The Spire",
          "type" : "card rpg",
          "priceUsd" : 20.0
        },
        "paths" : [ ],
        "type" : "Json"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('register new game') {\n    http.post(\"/api/game\", [\n            id: \"g1\", // define payload as a map\n            title: \"Slay The Spire\",\n            type: \"card rpg\",\n            priceUsd: 20])\n\n    http.get(\"/api/game/g1\") { // request newly created game as GET\n        id.should == \"g1\"\n        title.should == \"Slay The Spire\" // direct access to response JSON title property\n        type.should == \"card rpg\"\n        priceUsd.should == 20\n    }\n}",
        "title" : "POST and GET",
        "startLine" : "register-new-game",
        "endLine" : "scenario-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "http.doc",
        "revealLineStop" : [ 5 ],
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "Game POST Response",
        "pathsFile" : "game-store-rest-get-game/paths.json",
        "data" : {
          "id" : "g1",
          "title" : "Slay The Spire",
          "type" : "card rpg",
          "priceUsd" : 20.0
        },
        "paths" : [ "root.id", "root.title", "root.type", "root.priceUsd" ],
        "type" : "Json"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Did you notice that request to POST and response from GET looks the same? Let's extract payload into a variable and",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "re-use it for both request payload and response validation.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "This time we also not going to pass ",
          "type" : "SimpleText"
        }, {
          "code" : "id",
          "type" : "InlinedCode"
        }, {
          "text" : " to the request and instead rely on the server to generate a new ID.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore // optional package declaration for IDE happiness\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.* // optional single import for IDE autocomplete\n\nscenario('register new game') {\n    def payload = [title: \"Slay The Spire\",  // no ID specified this time\n                   type: \"card rpg\",\n                   priceUsd: 20]\n\n    def id = http.post(\"/api/game\", payload) {\n        return id // we grab id from response, return keyword is optional\n    }\n\n    http.get(\"/api/game/${id}\") { // using id for subsequent request\n        body.should == payload // re-using POST payload to assert GET response. Only values in payload will be validated\n    }\n}",
        "title" : "Re-use payload data",
        "excludeRegexp" : "http.doc",
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "HTTP Explicit Auth",
      "id" : "http-explicit-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "End-point ",
          "type" : "SimpleText"
        }, {
          "code" : "/api/game",
          "type" : "InlinedCode"
        }, {
          "text" : " was not requiring authentication. It was done for example’s sake to make it simpler to approach.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Now let's test an end-point that requires auth.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences without auth') {\n    http.put('/api/user-preferences', [favoriteGenre: 'RPG']) {\n        statusCode.should == 403 // forbidden, as this end-point requires authentication\n    }\n}",
        "title" : "auth required end-point",
        "startLine" : "without-auth",
        "endLine" : "without-auth-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To authenticate a user our system relies on ",
          "type" : "SimpleText"
        }, {
          "code" : "Bearer",
          "type" : "InlinedCode"
        }, {
          "text" : " token. Let's generate a token and explicitly pass it",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "via ",
          "type" : "SimpleText"
        }, {
          "code" : "header",
          "type" : "InlinedCode"
        }, {
          "text" : " parameter.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences with explicit auth') {\n    def token = generateToken('user-a') // generates token using our system underlying auth system\n\n    http.put('/api/user-preferences',\n            http.header([Authorization: \"Bearer ${token}\"]), // explicitly pass Bearer token\n            [favoriteGenre: 'RPG']) {\n        userId.should == 'user-a' // make sure server recognized token and properly authenticated user\n    }\n}",
        "title" : "explicit auth",
        "startLine" : "with-explicit-auth",
        "endLine" : "with-explicit-auth-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "http.doc",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "User preferences response",
        "pathsFile" : "game-store-put-user-preferences/paths.json",
        "data" : {
          "userId" : "user-a",
          "favoriteGenre" : "RPG"
        },
        "paths" : [ "root.userId" ],
        "type" : "Json"
      } ]
    }, {
      "title" : "Personas",
      "id" : "personas",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Webtau provides a way to implement implicit authentication for your requests.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Before we get there, we need to cover ",
          "type" : "SimpleText"
        }, {
          "code" : "Persona",
          "type" : "InlinedCode"
        }, {
          "text" : " concept.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "code" : "Persona",
          "type" : "InlinedCode"
        }, {
          "text" : " sets the context for config values and code execution.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "userId = 'NA' // custom config value defined in the default context\n\npersonas { // persona config section, similar to environments config section\n    Alice {\n        userId = \"uid-alice\" // Alice's specific config value\n    }\n\n    Bob {\n        userId = \"uid-bob\" // Bob's specific config value\n    }\n}",
        "title" : "webtau.cfg.groovy",
        "excludeRegexp" : "package",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 33%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "def Alice = persona('Alice') // define Alice persona\ndef Bob = persona('Bob') // define Bob persona\n\nscenario('persona demo') {\n    println cfg.userId // custom value from config\n\n    Alice {\n        println cfg.userId // custom value from config in Alice's context\n    }\n\n    Bob {\n        println cfg.userId // custom value from config in Bob's context\n    }\n}",
        "title" : "personaDemo.groovy",
        "startLine" : "persona-demo",
        "endLine" : "persona-demo-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "output",
        "startLine" : "persona demo",
        "endLine" : "uid-bob",
        "revealLineStop" : [ 0, 1, 2 ],
        "lines" : [ "\u001B[34mpersona demo \u001B[35m(personaDemo.groovy)\u001B[0m", "NA", "uid-alice", "uid-bob" ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "HTTP Implicit Auth",
      "id" : "http-implicit-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Instead of explicitly passing ",
          "type" : "SimpleText"
        }, {
          "code" : "header",
          "type" : "InlinedCode"
        }, {
          "text" : " to each ",
          "type" : "SimpleText"
        }, {
          "code" : "http",
          "type" : "InlinedCode"
        }, {
          "text" : " call we will execute calls in the context of a persona.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences with personas auth') {\n    Alice { // Alice's context\n        http.put('/api/user-preferences', [favoriteGenre: 'RPG']) {\n            userId.should == 'uid-alice' // validating that we updated the right user\n            favoriteGenre.should == 'RPG'\n        }\n    }\n\n    Bob { // Bob's context\n        http.put('/api/user-preferences', [favoriteGenre: 'Strategy']) {\n            userId.should == 'uid-bob' // validating that we updated the right user\n            favoriteGenre.should == 'Strategy'\n        }\n    }\n}",
        "title" : "Persona auth PUT",
        "startLine" : "with-personas-put",
        "endLine" : "with-personas-put-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Console output (and report that we are going to look at later) captures what steps were executed in what context.",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "webtau output",
        "startLine" : "running:",
        "endLine" : "Bob",
        "highlight" : [ 2, 26, 27, 30 ],
        "lines" : [ "\u001B[34mrunning: \u001B[35mscenarios/gamestore/userPreferencesRest.groovy \u001B[33msave preferences with personas auth\u001B[0m", "\u001B[34msave preferences with personas auth \u001B[35m(userPreferencesRest.groovy)\u001B[0m", "\u001B[33m> \u001B[33mAlice \u001B[0m\u001B[34mexecuting HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[0m", "\u001B[33mrequest\u001B[36m (application/json):\u001B[0m", "\u001B[33m{\u001B[0m", "  \u001B[35m\"favoriteGenre\": \u001B[32m\"RPG\"\u001B[0m", "\u001B[33m}\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mbody.userId \u001B[32mequals \"uid-alice\"", "      matches:", "      ", "      body.userId:   actual: \"uid-alice\" <java.lang.String>", "                   expected: \"uid-alice\" <java.lang.String>\u001B[33m (\u001B[32m18ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mbody.favoriteGenre \u001B[32mequals \"RPG\"", "      matches:", "      ", "      body.favoriteGenre:   actual: \"RPG\" <java.lang.String>", "                          expected: \"RPG\" <java.lang.String>\u001B[33m (\u001B[32m0ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mheader.statusCode \u001B[32mequals 200", "      matches:", "      ", "      header.statusCode:   actual: 200 <java.lang.Integer>", "                         expected: 200 <java.lang.Integer>\u001B[33m (\u001B[32m1ms\u001B[33m)\u001B[0m", "  \u001B[33m> \u001B[33mAlice \u001B[0m\u001B[34mvalidating \u001B[36mrequest and response\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[34mvalidated \u001B[36mrequest and response\u001B[33m (\u001B[32m149ms\u001B[33m)\u001B[0m", "\u001B[33mresponse\u001B[36m (application/json):\u001B[0m", "\u001B[33m{\u001B[0m", "  \u001B[35m\"userId\": \u001B[32m\u001B[1m\u001B[32m__\"uid-alice\"__\u001B[33m,\u001B[0m", "  \u001B[35m\"favoriteGenre\": \u001B[32m\u001B[1m\u001B[32m__\"RPG\"__\u001B[0m", "\u001B[33m}\u001B[0m", "\u001B[32m. \u001B[33mAlice \u001B[0m\u001B[34mexecuted HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[33m (\u001B[32m320ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[33mBob \u001B[0m\u001B[34mexecuting HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To make sure our ",
          "type" : "SimpleText"
        }, {
          "code" : "PUT",
          "type" : "InlinedCode"
        }, {
          "text" : " worked as intended we are going to ",
          "type" : "SimpleText"
        }, {
          "code" : "GET",
          "type" : "InlinedCode"
        }, {
          "text" : " user preferences in different Persona contexts.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('read preferences with personas auth') {\n    Alice { // Alice's context\n        http.get('/api/user-preferences') {\n            favoriteGenre.should == 'RPG' // we get back the Alice's favorite genre\n        }\n    }\n\n    Bob { // Bob's context\n        http.get('/api/user-preferences') {\n            favoriteGenre.should == 'Strategy' // we get back the Bob's favorite genre\n        }\n    }\n}",
        "title" : "Persona auth GET",
        "startLine" : "with-personas-get",
        "endLine" : "with-personas-get-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "http.doc",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "How does it work behind the covers? ",
          "type" : "SimpleText"
        }, {
          "code" : "Webtau",
          "type" : "InlinedCode"
        }, {
          "text" : " allows you to define an implicit ",
          "type" : "SimpleText"
        }, {
          "code" : "HTTP Header Provider",
          "type" : "InlinedCode"
        }, {
          "text" : " that",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "can inject header values into each request.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "httpHeaderProvider = HttpHeaderProvider.&provide // implicit header provider\n\nuserId = '' // explicitly set default userId to be an empty string\n\npersonas {\n    Alice {\n        userId = 'uid-alice' // Alice's system specific user id\n    }\n\n    Bob {\n        userId = 'uid-bob' // Bob's system specific user id\n    }\n}",
        "title" : "webtau.cfg.groovy",
        "startLine" : "personas-auth-config",
        "endLine" : "personas-auth-config-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "browserPageNavigationHandler",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Our custom implementation of ",
          "type" : "SimpleText"
        }, {
          "code" : "HTTP Header Provider",
          "type" : "InlinedCode"
        }, {
          "text" : " checks ",
          "type" : "SimpleText"
        }, {
          "code" : "cfg.userId",
          "type" : "InlinedCode"
        }, {
          "text" : " value and when it is present,",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "it will be used to generate ",
          "type" : "SimpleText"
        }, {
          "code" : "Bearer",
          "type" : "InlinedCode"
        }, {
          "text" : " token and inject into ongoing request.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Note: ",
          "type" : "SimpleText"
        }, {
          "code" : "cfg.userId",
          "type" : "InlinedCode"
        }, {
          "text" : " is only set in the context of ",
          "type" : "SimpleText"
        }, {
          "code" : "Bob",
          "type" : "InlinedCode"
        }, {
          "text" : " or ",
          "type" : "SimpleText"
        }, {
          "code" : "Alice",
          "type" : "InlinedCode"
        }, {
          "text" : ". Outside persona context ",
          "type" : "SimpleText"
        }, {
          "code" : "userId",
          "type" : "InlinedCode"
        }, {
          "text" : " is an empty value.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package auth\n\nimport org.testingisdocumenting.webtau.http.HttpHeader\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass HttpHeaderProvider {\n    static provide(String fullUrl, String url, // provide method will be called for every HTTP request\n                   HttpHeader httpHeaders) {\n        def userId = cfg.userId // grab custom userId config value, depends on the Persona context. Based on our current config, it is empty outside persona context.\n        return userId ?\n                httpHeaders.with(\"Authorization\", // create new http header by taking a header passed by a test explicitly and adding Authorization key-value\n                                 \"Bearer ${generateToken(userId)}\"):\n                httpHeaders // original header passed by a test\n    }\n\n    // generate token based on your auth system, dummy impl for the demo purposes only\n    private static def generateToken(String userId) {\n        return userId.bytes.encodeBase64().toString()\n    }\n}",
        "title" : "HTTP Header Provider",
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "GraphQL",
      "id" : "graphql",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We covered how to use ",
          "type" : "SimpleText"
        }, {
          "code" : "http.",
          "type" : "InlinedCode"
        }, {
          "text" : " namespace to test REST based API layer. Let's move to ",
          "type" : "SimpleText"
        }, {
          "code" : "graphql.",
          "type" : "InlinedCode"
        }, {
          "text" : " namespace to",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "test GraphQL based API.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Game Store provided a few queries and mutations:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "graphqls",
        "snippet" : "type Query {\n    games: [Game]\n    game(id: String): Game\n    userPreferences: UserPreferences\n}\n\ntype Mutation {\n    createGame(id: String!, title: String!, type: String!, priceUsd: Int!): Game\n    updateUserPreferences(favoriteGenre: String): UserPreferences\n}\n\ntype Game {\n    id: String\n    title: String\n    type: String\n    priceUsd: Int\n}\n\ntype UserPreferences {\n    userId: String\n    favoriteGenre: String\n}",
        "title" : "GraphQL schema",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To start, we define a query to fetch a game by hardcoding id in the query.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "def query = '''\nquery {\n  game(id: \"g1\") {\n    title\n    type\n  }\n}\n'''",
        "title" : "query definition",
        "startLine" : "query-definition-start",
        "endLine" : "query-definition-end",
        "excludeStartEnd" : true,
        "meta" : {
          "stickySlide" : "left 33%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('query game') {\n    graphql.execute(query) {\n        game.title.should == \"Slay The Spire\" // explicit access through query name\n        title.should == \"Slay The Spire\" // implicit access in case of the single query\n    }\n}",
        "title" : "GraphQL query",
        "startLine" : "query-game-start",
        "endLine" : "query-game-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "http.doc",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "response",
        "pathsFile" : "game-store-graphql-game/paths.json",
        "data" : {
          "data" : {
            "game" : {
              "title" : "Slay The Spire",
              "type" : "card rpg"
            }
          }
        },
        "paths" : [ "root.data.game.title" ],
        "type" : "Json"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "GraphQL allows to define a query with parameters:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "def queryWithParams = '''\nquery game($id: String!) {\n  game(id: $id) {\n    title\n    type\n  }\n}\n'''",
        "title" : "params query definition",
        "startLine" : "query-params-definition-start",
        "endLine" : "query-params-definition-end",
        "excludeStartEnd" : true,
        "meta" : {
          "stickySlide" : "top"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Webtau provides a way to pass parameter values as a ",
          "type" : "SimpleText"
        }, {
          "code" : "Map",
          "type" : "InlinedCode"
        }, {
          "text" : ":",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('query game with param') {\n    graphql.execute(queryWithParams, [id: 'g1']) {\n        title.should == \"Slay The Spire\"\n    }\n}",
        "title" : "query parameters",
        "startLine" : "query-game-param-start",
        "endLine" : "query-game-param-end",
        "excludeStartEnd" : true,
        "highlight" : [ 1 ],
        "excludeRegexp" : "http.doc",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "GraphQL Explicit Auth",
      "id" : "graphql-explicit-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "As in REST based user preference example above, ",
          "type" : "SimpleText"
        }, {
          "code" : "updateUserPreferences",
          "type" : "InlinedCode"
        }, {
          "text" : " mutation requires authentication.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "def mutation = '''\nmutation updateUserPreferences($favoriteGenre: String!) {\n  updateUserPreferences(favoriteGenre: $favoriteGenre) { \n    userId\n    favoriteGenre\n  }\n}\n'''",
        "title" : "mutation to change preferences",
        "startLine" : "mutation-definition-start",
        "endLine" : "mutation-definition-end",
        "excludeStartEnd" : true,
        "meta" : {
          "stickySlide" : "top"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Unlike REST based API, the auth error appears in ",
          "type" : "SimpleText"
        }, {
          "code" : "errors",
          "type" : "InlinedCode"
        }, {
          "text" : " field on a response and not via ",
          "type" : "SimpleText"
        }, {
          "code" : "statusCode",
          "type" : "InlinedCode"
        }, {
          "text" : ":",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "GraphQL error response",
        "pathsFile" : "graphql-auth-error/paths.json",
        "meta" : {
          "stickySlide" : "left"
        },
        "data" : {
          "errors" : [ {
            "message" : "forbidden"
          } ],
          "data" : {
            "updateUserPreferences" : null
          }
        },
        "paths" : [ "root.errors[0].message" ],
        "type" : "Json"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences without auth') {\n    graphql.execute(mutation, [favoriteGenre: 'CRPG']) {\n        errors.message.should == ['forbidden'] // shortcut to take a message from each error in the list\n    }\n}",
        "title" : "not authenticated error",
        "startLine" : "without-auth",
        "endLine" : "without-auth-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : ".doc",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To do auth explicitly, similar to REST API, we can pass ",
          "type" : "SimpleText"
        }, {
          "code" : "header",
          "type" : "InlinedCode"
        }, {
          "text" : " as a parameter to ",
          "type" : "SimpleText"
        }, {
          "code" : "graphql.execute",
          "type" : "InlinedCode"
        }, {
          "text" : ":",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences with explicit auth') {\n    def token = generateToken('user-a')\n\n    graphql.execute(mutation, [favoriteGenre: 'CRPG'],\n            http.header([Authorization: \"Bearer ${token}\"])) {\n        userId.should == 'user-a'\n    }\n}",
        "title" : "explicit authentication",
        "startLine" : "with-explicit-auth",
        "endLine" : "with-explicit-auth-end",
        "excludeStartEnd" : true,
        "type" : "Snippet"
      } ]
    }, {
      "title" : "GraphQL Persona Auth",
      "id" : "graphql-persona-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Persona based authentication for GraphQL works exactly like REST API based one.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('save preferences with personas auth') {\n    Alice { // Personas we defined and used for HTTP REST API\n        graphql.execute(mutation, [favoriteGenre: 'RPG']) {\n            userId.should == 'uid-alice' // make sure system picked Alice as a user\n            favoriteGenre.should == 'RPG'\n        }\n    }\n\n    Bob {\n        graphql.execute(mutation, [favoriteGenre: 'Strategy']) {\n            userId.should == 'uid-bob' // make sure system picked Bob as a user\n            favoriteGenre.should == 'Strategy'\n        }\n    }\n}",
        "title" : "Persona authentication",
        "startLine" : "with-personas-put",
        "endLine" : "with-personas-put-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "httpHeaderProvider = HttpHeaderProvider.&provide // implicit header provider\n\nuserId = '' // explicitly set default userId to be an empty string\n\npersonas {\n    Alice {\n        userId = 'uid-alice' // Alice's system specific user id\n    }\n\n    Bob {\n        userId = 'uid-bob' // Bob's system specific user id\n    }\n}",
        "title" : "webtau.cfg.groovy",
        "startLine" : "personas-auth-config",
        "endLine" : "personas-auth-config-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "browserPageNavigationHandler",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package auth\n\nimport org.testingisdocumenting.webtau.http.HttpHeader\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass HttpHeaderProvider {\n    static provide(String fullUrl, String url, // provide method will be called for every HTTP request\n                   HttpHeader httpHeaders) {\n        def userId = cfg.userId // grab custom userId config value, depends on the Persona context. Based on our current config, it is empty outside persona context.\n        return userId ?\n                httpHeaders.with(\"Authorization\", // create new http header by taking a header passed by a test explicitly and adding Authorization key-value\n                                 \"Bearer ${generateToken(userId)}\"):\n                httpHeaders // original header passed by a test\n    }\n\n    // generate token based on your auth system, dummy impl for the demo purposes only\n    private static def generateToken(String userId) {\n        return userId.bytes.encodeBase64().toString()\n    }\n}",
        "title" : "previously defined HTTP Header Provider",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's make system reflects the changes performed with mutations",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "def query = '''\nquery {\n  userPreferences {\n    userId\n    favoriteGenre\n  }\n}\n'''",
        "title" : "query to fetch preferences",
        "startLine" : "query-definition-start",
        "endLine" : "query-definition-end",
        "excludeStartEnd" : true,
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('read preferences with personas auth') {\n    Alice {\n        graphql.execute(query) {\n            favoriteGenre.should == 'RPG' // making sure correct data is returned back\n        }\n    }\n\n    Bob {\n        graphql.execute(query) {\n            favoriteGenre.should == 'Strategy'  // Strategy games are not bad\n        }\n    }\n}",
        "title" : "Persona authentication",
        "startLine" : "with-personas-get",
        "endLine" : "with-personas-get-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "Personas Re-use",
      "id" : "personas-re-use",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We started with defining personas in-place within each test file like this:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "import static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\ndef Alice = persona('Alice') // define Alice persona\ndef Bob = persona('Bob') // define Bob persona\n\nscenario('persona demo') {\n    println cfg.userId // custom value from config\n\n    Alice {\n        println cfg.userId // custom value from config in Alice's context\n    }\n\n    Bob {\n        println cfg.userId // custom value from config in Bob's context\n    }\n}",
        "title" : "in place defined personas",
        "excludeRegexp" : [ "// persona-demo", "package" ],
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "As we start using Personas for multiple tests and multiple files it makes sense to define Personas once and",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "reference them in tests as needed.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package personas // user defined package name/directory\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass Personas { // class name can be anything\n    public static final def Admin = persona('Admin')\n    public static final def Alice = persona('Alice')\n    public static final def Bob = persona('Bob')\n}",
        "title" : "personas/Personas.groovy",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "top 30%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To use defined personas we leverage Java/Groovy static import:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package basicScenarios\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\nimport static personas.Personas.* // import all available personas to be in scope\n\nscenario('persona demo') {\n    println cfg.userId\n\n    Alice { // Alice is taken from personas.Personas.*\n        println cfg.userId\n    }\n\n    Bob {\n        println cfg.userId\n    }\n}",
        "title" : "Persona re-use demo",
        "excludeRegexp" : "// persona-demo",
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "Browser",
      "id" : "browser",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We looked at how to test REST and GraphQL based APIs. Now let's move on to testing Web UI.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Before we jump into testing Game Store UI, we will do a classic test of Google Page.",
          "type" : "SimpleText"
        } ]
      }, {
        "imageSrc" : "/blog/browser-basic.png",
        "timestamp" : 1603733864858,
        "shapes" : [ ],
        "width" : 1000.0,
        "height" : 677.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Our test will enter \"test\" value into the search box and, wait for the results to show up and pick a result based on",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "a regular expression:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('basic browser interaction') {\n    browser.open(\"https://google.com\")\n    $('input[title=\"Search\"]').setValue(\"test\\n\") // set value based on the underlying component\n\n    $('h3').count.waitTo >= 1 // explicit, simplified wait on condition\n    $(\"h3\").get(~/Speedtest.*Ookla/).click() // example of filter based on regular expression\n\n    browser.url.full.should == ~/speedtest.net/ // full url assertion\n}",
        "title" : "basic browser interactions",
        "startLine" : "browser-basics",
        "endLine" : "browser-basics-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "browser.doc",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "As with REST and GraphQL, webtau console output captures all the actions that happen, and how much time each",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "action took:",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "webtau output",
        "startLine" : "basic browser interaction",
        "endLine" : "expected pattern: speedtest.net",
        "highlight" : [ 4, 10, 16, 18 ],
        "lines" : [ "\u001B[34mbasic browser interaction \u001B[35m(browserBasics.groovy)\u001B[0m", "\u001B[34mpreparing \u001B[33mchrome\u001B[34m WebDriver\u001B[0m", "\u001B[33m> \u001B[34mopening \u001B[35mhttps://google.com\u001B[0m", "\u001B[32m. \u001B[34mopened \u001B[35mhttps://google.com\u001B[33m (\u001B[32m461ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[34msetting value \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[33m> \u001B[34mclearing \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[32m. \u001B[34mcleared \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m36ms\u001B[33m)\u001B[0m", "  \u001B[33m> \u001B[34msending keys \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[32m. \u001B[34msent keys \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m936ms\u001B[33m)\u001B[0m", "\u001B[32m. \u001B[34mset value \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m1s 10ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[34mwaiting \u001B[33mto \u001B[36mcount \u001B[33mof \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[32mto be greater than or equal to 1\u001B[0m", "\u001B[32m. \u001B[36mcount \u001B[33mof \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[32mgreater than or equal 1", "    matches:", "    ", "    count:   actual: 15 <java.lang.Integer>", "           expected: greater than or equal to 1 <java.lang.Integer>\u001B[33m (\u001B[32m29ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[34mclicking \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[37m, \u001B[35melement(s) with regexp \u001B[1m\u001B[35mSpeedtest.*Ookla\u001B[0m", "\u001B[32m. \u001B[34mclicked \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[37m, \u001B[35melement(s) with regexp \u001B[1m\u001B[35mSpeedtest.*Ookla\u001B[33m (\u001B[32m774ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[34mexpecting \u001B[36mfull page url \u001B[33mof \u001B[0m\u001B[1mbrowser \u001B[32mto equal pattern /speedtest.net/\u001B[0m", "\u001B[32m. \u001B[36mfull page url \u001B[33mof \u001B[0m\u001B[1mbrowser \u001B[32mequals pattern /speedtest.net/", "    matches:", "    ", "    full page url:    actual string: https://www.speedtest.net/", "                   expected pattern: speedtest.net\u001B[33m (\u001B[32m4ms\u001B[33m)\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Note: Both passed and failed assertions are captured.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Game Store UI",
      "id" : "game-store-ui",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "The first Game Store page we are going to test is a landing page. It shows available games and let you filter",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "based on text or price.",
          "type" : "SimpleText"
        } ]
      }, {
        "fit" : true,
        "imageSrc" : "/blog/landing-page.png",
        "timestamp" : 1604503512661,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 1354.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We covered how to use ",
          "type" : "SimpleText"
        }, {
          "code" : "http.",
          "type" : "InlinedCode"
        }, {
          "text" : " layer to create new games. We can use that to prepare a setup for our UI test:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nscenario('landing page') {\n    http.post(\"/api/game\", [id: \"g1\", title: \"Slay The Spire\", type: \"card rpg\", priceUsd: 20]) // pre-create test data using HTTP\n    http.post(\"/api/game\", [id: \"g2\", title: \"Civilization 6\", type: \"strategy\", priceUsd: 60])\n    http.post(\"/api/game\", [id: \"g3\", title: \"Doom\", type: \"fps\", priceUsd: 40])\n\n    browser.open(\"/\") // open landing page, relying on url and/or browserUrl\n    def titles = $('[class*=\"GamesList_title\"]') // define titles as page element selected by css\n\n    titles.waitTo == ['Civilization 6', 'Doom', 'Slay The Spire'] // wait for games titles to show up and match our expectations\n\n    http.delete(\"/api/game/g3\") // delete a single game using HTTP\n\n    titles.waitTo == ['Civilization 6', 'Slay The Spire'] // wait for UI to reflect changes\n}",
        "title" : "Browser Landing test",
        "excludeRegexp" : [ "browser.doc", "hide", ".capture" ],
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "fit" : true,
        "imageSrc" : "/blog/landing-page-reduced.png",
        "timestamp" : 1604503513522,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 1354.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's test the filters:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('filter by text') {\n    browser.reopen(\"/\")\n\n    $(\"#filter\").setValue(\"civ\") // use setValue abstraction to set value inside input box\n    $('[class*=\"GamesList_title\"]').waitTo == ['Civilization 6'] // wait for changes to be reflected\n}\n\nscenario('filter by price') {\n    browser.reopen(\"/\")\n\n    $(\"#below60\").setValue(true) // use setValue abstraction to set value for a checkbox\n    $('[class*=\"GamesList_title\"]').waitTo == ['Doom', 'Slay The Spire'] // wait for changes to be reflected\n}",
        "title" : "filtering games",
        "startLine" : "filter-start",
        "endLine" : "filter-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : [ "hide", "browser.doc" ],
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Note: ",
          "type" : "SimpleText"
        }, {
          "code" : "setValue",
          "type" : "InlinedCode"
        }, {
          "text" : " is used for both text input box and check box. Webtau will figure out what actions to perform based on the",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "underlying form element.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "UI Page Object",
      "id" : "ui-page-object",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If you have experience in writing UI tests, you may have heard about ",
          "type" : "SimpleText"
        }, {
          "url" : "https://martinfowler.com/bliki/PageObject.html",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "Page Object pattern",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : ".",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Basic idea is to separate what user can see or do from technical details of how to simulate the actions or query the values.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If we take a look at the code in our UI test we will see that details of how to locate elements on the UI are exposed.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Any time we change id element or class names, we risk breaking our tests.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Warning: Tests should not be broken if only implementation details has changed.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "$(\"#filter\").setValue(\"civ\") // exposing css selector to the test is going to haunt you later\n$('[class*=\"GamesList_title\"]').waitTo == ['Civilization 6'] // class based selection is more likely to become out of sync",
        "title" : "exposed page details",
        "startLine" : "impl-details",
        "endLine" : "impl-details-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To implement page object in Webtau we will use a regular Java/Groovy/Kotlin class:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package pages\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass LandingPage {\n    def titles = $('[class*=\"GamesList_title\"]')\n    def filterText = $(\"#filter\") // lazy declaration for future usage, no actual attempt to find element is performed\n    def filterBelow60 = $(\"#below60\")\n    def labelBelow60 = $(\"span\").get('Below $60') // filters chaining is also lazy\n    def adminMessage = $(\"#admin-message\")\n\n    def reopen() {\n        browser.reopen(\"/\")\n    }\n}",
        "title" : "page object",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Since our page object class is stateless and elements declarations are lazy, we can precreate instances of all",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "the page objects in one place:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package pages\n\nclass Pages {\n    static final def maintenance = new MaintenancePage() // pre-creating stateless instances\n    static final def login = new LoginPage()\n    static final def landing = new LandingPage() // for all the pages our test suite needs to have access\n    static final def userPreferences = new UserPreferencesPage()\n}",
        "title" : "all pages (similar to Personas)",
        "commentsType" : "inline",
        "excludeRegexp" : "report",
        "meta" : {
          "stickySlide" : "top 30%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\nimport static pages.Pages.* // import all the pages into test scope\n\nscenario('filter by text') {\n    landing.reopen()\n    // set value using input defined in the page object\n    landing.filterText.setValue(\"last\")\n\n    landing.titles.waitTo == ['Last Of Us 2']\n}\n\nscenario('filter by price') {\n    landing.reopen()\n    // set checkbox value using input defined in the page object\n    landing.filterBelow60.setValue(true)\n\n    landing.titles.waitTo == ['Assassin Creed Odyssey', 'Division 2',\n                              'Hearthstone', 'Inside', 'Slay The Spire']\n}",
        "title" : "filtering games",
        "commentsType" : "inline",
        "excludeRegexp" : [ "browser.doc", "hide", ".capture" ],
        "type" : "Snippet"
      } ]
    }, {
      "title" : "WaitTo",
      "id" : "waitto",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "You saw ",
          "type" : "SimpleText"
        }, {
          "code" : "waitTo",
          "type" : "InlinedCode"
        }, {
          "text" : " in a couple of places already. Let's pause on the topic.",
          "type" : "SimpleText"
        } ]
      }, {
        "stickySlide" : "top 20%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Question: Why do we need ",
          "type" : "SimpleText"
        }, {
          "code" : "waitTo",
          "type" : "InlinedCode"
        }, {
          "text" : " and can we instead make ",
          "type" : "SimpleText"
        }, {
          "code" : "should",
          "type" : "InlinedCode"
        }, {
          "text" : " do the waiting?",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationParagraph" : "default",
        "type" : "Meta"
      }, {
        "stickySlide" : "top 20%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We could. However, semantics are important. I think it is important to distinct between an immediate result,",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "and a result that becomes available over time.",
          "type" : "SimpleText"
        } ]
      }, {
        "stickySlide" : "top 30%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Are our users going to see the result right away? Is database going to have the result right away? Is command line going",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "to print that line right away?",
          "type" : "SimpleText"
        } ]
      }, {
        "stickySlide" : "left",
        "type" : "Meta"
      }, {
        "presentationParagraph" : "",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Additionally ",
          "type" : "SimpleText"
        }, {
          "code" : "waitTo",
          "type" : "InlinedCode"
        }, {
          "text" : " is not specific for ",
          "type" : "SimpleText"
        }, {
          "code" : "browser.",
          "type" : "InlinedCode"
        }, {
          "text" : " layer. It can be used to wait on files content, console output, database data, etc.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "// waiting on query to finally return a value (eventual consistency)\ndb.query(\"select * from games\").waitTo contain([title: \"Slay The Spire\"])\n// waiting of file content to contain a line\nfs.textContent(\"my-file.txt\").waitTo contain('important line')\n\ndef command = cli.runInBackground(\"admin-tool\")\nlogin.login(\"myname\", \"mypassword\")\n// waiting on command line tool to print important message\ncommand.output.waitTo contain(\"<myname> logged in\")",
        "title" : "waitTo is NOT browser specific",
        "startLine" : "wait-to-demo",
        "endLine" : "wait-to-demo-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "BlockQuote",
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "Testing Is Documenting",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Testing is Documenting is my moto. WaitTo semantics allow you to look at the test and get a better understanding of how system behaves.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "This is an example of a more subtle, more common definition of how tests can help you to understand the system.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Later I will show you how to make tests help you with the actual documentation in a more explicit manner.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Browser Explicit Auth",
      "id" : "browser-explicit-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Game Store have a page where users can update their user preferences.",
          "type" : "SimpleText"
        } ]
      }, {
        "caption" : "user preferences",
        "fit" : true,
        "imageSrc" : "/blog/user-preferences-screen.png",
        "timestamp" : 1605069513311,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 954.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If we go to that page directly, we will be redirected to the login page instead.",
          "type" : "SimpleText"
        } ]
      }, {
        "caption" : "login is required",
        "fit" : true,
        "imageSrc" : "/blog/login-screen.png",
        "timestamp" : 1605069510756,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 954.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In order to test user preferences page, we have to choices:",
          "type" : "SimpleText"
        } ]
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "handle login explicitly",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "handle login implicitly",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('user preferences redirects to login') {\n    userPreferences.open() // open user preferences page\n\n    login.name.waitTo beVisible\n    browser.url.ref.should == '/login' // but landed on login page\n\n    login.login('uid-test', 'dummy-password') // explicitly enter user name and password\n\n    userPreferences.userId.waitTo == 'uid-test' // after redirect we can see user preferences\n    userPreferences.favoriteGenre.should == ''\n}",
        "title" : "Explicit Login",
        "startLine" : "explicit-login-start",
        "endLine" : "explicit-login-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "excludeRegexp" : "browser.doc",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package pages\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass UserPreferencesPage {\n    def userId = $('#user-id') // user id to assert on\n    def favoriteGenre = $('#favorite-genre') // genre to validate/set\n    def saveButton = $('#save')\n    def saveResultMessage = $('#save-result')\n\n    def open() {\n        browser.reopen(\"/#/user\")\n    }\n\n    def save() { // exposed action - regular method\n        saveButton.click()\n    }\n}",
        "title" : "user preferences page object",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "temp"
        },
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package pages\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass LoginPage {\n    def name = $('#name') // name to wait on\n    def password = $('#password')\n    def loginButton = $('#login')\n\n    void login(name, password) { // action to login with\n        this.name.setValue(name)\n        this.password.setValue(password)\n\n        loginButton.click()\n    }\n}",
        "title" : "login page object",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Explicit login approach works well if we go the page once, and we know that we haven't performed login yet.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "If on the other hand we need to get to that page as part of other scenario, we may face the case where we have already",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "logged-in, and the code that assumed logic redirection will fail.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To fix that we will need to add additional if-else logic that may complicate things a bit.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Alternatively we can use an implicit login with Personas.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Browser Implicit Auth",
      "id" : "browser-implicit-auth",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Browser Implicit Auth in also Persona based.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('implicit login with persona') {\n    Alice { // In the Alice's context\n        http.put('/api/user-preferences', [favoriteGenre: 'RPG']) // prepare data to assert on - another example of http/browser test combination\n\n        userPreferences.open() // open user preferences\n\n        userPreferences.userId.waitTo == 'uid-alice' // we expect user preferences screen, not the login screen\n        userPreferences.favoriteGenre.should == 'RPG' // our assertion matches what we set using REST API\n    }\n}",
        "title" : "Persona Login",
        "startLine" : "persona-login-start",
        "endLine" : "persona-login-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "browser.doc",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's now update preferences through UI and validate them using REST API:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('change preferences through UI') {\n    Bob { http.put('/api/user-preferences', [favoriteGenre: 'Sim']) } // Set Bob's preference via HTTP\n\n    Alice {\n        userPreferences.open()\n\n        userPreferences.favoriteGenre.waitTo beVisible() // wait for UI to load data from REST endpoint\n        userPreferences.favoriteGenre.setValue('CRPG')\n        userPreferences.save() // save user preferences\n\n        userPreferences.saveResultMessage.waitTo == 'Saved' // wait for visual clue to appear\n    }\n\n    Bob { // In Bob's context\n        http.get('/api/user-preferences') {\n            favoriteGenre.should == 'Sim' // Bob's preferences were not affected by UI\n        }\n    }\n\n    Alice { // In Alice's context\n        http.get('/api/user-preferences') {\n            favoriteGenre.should == 'CRPG' // Genre is the one we set\n        }\n    }\n}",
        "title" : "Update Through UI",
        "startLine" : "change-through-ui-start",
        "endLine" : "change-through-ui-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To make implicit auth work we need to implement ",
          "type" : "SimpleText"
        }, {
          "code" : "browserPageNavigationHandler",
          "type" : "InlinedCode"
        }, {
          "text" : ".",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "A handler that will be called for each page open event.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package auth\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass BrowserOpenHandler {\n    private static STORAGE_KEY = 'authToken'\n\n    static void handleOpen(passedUrl, fullUrl, currentUrl) { // will be called for every page open\n        def userId = cfg.userId // take user from config based on current persona\n        if (!userId || browser.localStorage.getItem(STORAGE_KEY)) { // if no user or token is inside storage, we don't need to do anything\n            return\n        }\n\n        browser.localStorage.setItem(STORAGE_KEY, generateToken(userId)) // set a new auth token generated based on current persona\n        browser.reopen(fullUrl) // re-open original page\n    }\n\n    // generate token based on your auth system, dummy impl for the demo purposes only\n    private static def generateToken(String userId) {\n        return userId.bytes.encodeBase64().toString()\n    }\n}",
        "title" : "Browser Navigation Handler",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 50%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Note: Game Store UI code uses local storage to manage auth token. In your app it could be session storage or cookies.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "browserPageNavigationHandler = BrowserOpenHandler.&handleOpen // implicit page open handler\n\nuserId = '' // explicitly set default userId to be an empty string\n\npersonas {\n    Alice {\n        userId = 'uid-alice' // Alice's system specific user id\n    }\n\n    Bob {\n        userId = 'uid-bob' // Bob's system specific user id\n    }\n}",
        "title" : "webtau.cfg.groovy - personas setup",
        "startLine" : "personas-auth-config",
        "endLine" : "personas-auth-config-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : "httpHeaderProvider",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Question: How do we maintain different localStorage for different Personas?",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationParagraph" : "default",
        "presentationBulletListType" : "RevealBoxes",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "code" : "Webtau",
          "type" : "InlinedCode"
        }, {
          "text" : " maintains a browser per ",
          "type" : "SimpleText"
        }, {
          "code" : "persona",
          "type" : "InlinedCode"
        }, {
          "text" : ". In the examples above we have a total of two browsers during test run:",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationParagraph" : "clear",
        "type" : "Meta"
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Default browser",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Alice's browser",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "presentationParagraph" : "",
        "stickySlide" : "clear",
        "type" : "Meta"
      } ]
    }, {
      "title" : "Browser WebSocket",
      "id" : "browser-websocket",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Now that we know how to use Persona to manage multiple browsers,",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "we can write a test for the last part of Game Store UI - admin page to send messages to visitors.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Admin page allows to send a message to all visitors via WebSocket.",
          "type" : "SimpleText"
        } ]
      }, {
        "fit" : true,
        "meta" : {
          "stickySlide" : "left"
        },
        "imageSrc" : "/blog/admin-send-message.png",
        "timestamp" : 1605069480276,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 754.0,
        "type" : "AnnotatedImage"
      }, {
        "fit" : true,
        "imageSrc" : "/blog/landing-received-message.png",
        "timestamp" : 1605069480777,
        "shapes" : [ ],
        "width" : 2000.0,
        "height" : 754.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In order to test this we will need two browsers: one to send a message and another to receive a websocket event.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's start with defining a page object for the new page:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package pages\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass MaintenancePage {\n    def message = $('#message')\n    def sendMessage = $('button').get('send message')\n\n    def reopen() {\n        browser.reopen(\"/#/admin\")\n    }\n}",
        "title" : "page object",
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.* // single convenient import for IDE auto complete\nimport static pages.Pages.* // convenient access to all page objects\nimport static personas.Personas.* // convenient access to all Personas\n\nscenario('sending admin message') {\n    landing.reopen() // open landing page in a default browser\n\n    def message = 'Shop is going to be closed for maintenance'\n\n    Admin {\n        maintenance.reopen() // open maintenance page in Admin's browser\n        maintenance.message.setValue(message)\n        maintenance.sendMessage.click() // send notification message\n    }\n\n    landing.adminMessage.waitTo == message // in the default browser, wait for the message to arrive\n}",
        "title" : "Leveraging  multiple browsers",
        "excludeRegexp" : [ "browser.doc", "hide" ],
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "Database",
      "id" : "database",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Another layer to explore is Database. Database layer can be used to prepare test data. It can also be used to validate",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "data persistence after REST/GraphQL API calls.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Warning: Database layer is often considered to be implementation details, and most of your tests should not use it directly.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "However, it can be useful to validate that REST POST method did modify data in the database and didn't persist data in cache only.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('http post and db list games') {\n    db.update(\"delete from Game\") // wipe out table\n\n    http.post(\"/api/game\", [id: \"g1\", title: \"Slay The Spire\", type: \"card rpg\", priceUsd: 20])\n    // create two games using HTTP\n    http.post(\"/api/game\", [id: \"g2\", title: \"Civilization 6\", type: \"strategy\", priceUsd: 60])\n\n    def GAME = db.table(\"GAME\")\n    GAME.should == [\"*ID\" | \"TITLE\"] { // make sure DB reflects changes\n                   __________________________\n                     \"g1\" | \"Slay The Spire\"\n                     \"g2\" | \"Civilization 6\"}\n}",
        "title" : "Database query",
        "startLine" : "db-list",
        "endLine" : "scenario-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('db write and http list games') {\n    db.update(\"delete from Game\")\n\n    def GAME = db.table(\"GAME\")\n    // populate GAME table with two rows\n    GAME << [\"ID\" | \"TITLE\"           | \"TYPE\"     | \"PRICE_USD\"] {\n             ____________________________________________________\n             \"g1\" | \"Slay The Spire\"  | \"card rpg\" | 20\n             \"g2\" | \"Civilization 6\"  | \"strategy\" | 60  }\n\n    http.get(\"/api/game\") {\n        // expect body to contain a list of two games\n        body.should == [ \"*id\" | \"title\" ] {\n                       ___________________________\n                          \"g2\" | \"Civilization 6\"\n                          \"g1\" | \"Slay The Spire\" }\n    }\n}",
        "title" : "Database insert",
        "startLine" : "db-insert",
        "endLine" : "scenario-end",
        "excludeStartEnd" : true,
        "excludeRegexp" : [ "doc.capture" ],
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "title" : "Games list JSON response",
        "pathsFile" : "game-store-list-after-db/paths.json",
        "collapsedPaths" : [ "root._links", "root.page" ],
        "data" : [ {
          "id" : "g1",
          "title" : "Slay The Spire",
          "type" : "card rpg",
          "priceUsd" : 20.0
        }, {
          "id" : "g2",
          "title" : "Civilization 6",
          "type" : "strategy",
          "priceUsd" : 60.0
        } ],
        "paths" : [ "root[0].id", "root[0].title", "root[1].id", "root[1].title" ],
        "type" : "Json"
      } ]
    }, {
      "title" : "CLI Command",
      "id" : "cli-command",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Command line interface is our final layer to test.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Before we test admin app, let's see how ",
          "type" : "SimpleText"
        }, {
          "code" : "cli.",
          "type" : "InlinedCode"
        }, {
          "text" : " works on a simple command:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "cli.run(\"ls -l\")\n\ncli.run(\"ls -l\") {\n    output.should contain(\"webtau.cfg.groovy\")\n}",
        "title" : "example of command line run",
        "startLine" : "cli-basics",
        "endLine" : "cli-basics-end",
        "excludeStartEnd" : true,
        "highlight" : [ 3 ],
        "meta" : {
          "stickySlide" : "left"
        },
        "type" : "Snippet"
      }, {
        "highlightPath" : "cli-basics-ls/out.matched.txt",
        "lines" : [ "total 1032", "drwxr-xr-x   4 mykolagolubyev  staff     128 Oct 27 16:39 auth", "drwxr-xr-x  13 mykolagolubyev  staff     416 Oct 27 10:21 basicScenarios", "drwxr-xr-x   4 mykolagolubyev  staff     128 Oct 27 10:21 clicommands", "drwxr-xr-x   3 mykolagolubyev  staff      96 Oct 15 14:58 listeners", "drwxr-xr-x   8 mykolagolubyev  staff     256 Oct 31 23:01 pages", "drwxr-xr-x   3 mykolagolubyev  staff      96 Oct 31 22:59 personas", "drwxr-xr-x   8 mykolagolubyev  staff     256 Oct 27 10:21 scenarios", "drwxr-xr-x   3 mykolagolubyev  staff      96 Jul 29 13:24 test", "drwxr-xr-x   3 mykolagolubyev  staff      96 Oct 23 20:21 utils", "-rw-r--r--   1 mykolagolubyev  staff    1071 Oct 31 20:38 webtau.cfg.groovy", "-rw-r--r--   1 mykolagolubyev  staff  500422 Oct 31 23:20 webtau.report.html" ],
        "highlight" : [ 10 ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Our admin CLI tool works similar ",
          "type" : "SimpleText"
        }, {
          "code" : "ls",
          "type" : "InlinedCode"
        }, {
          "text" : " and list games available in the system:",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "Admin tool output",
        "lines" : [ "\u001B[36mList of games\u001B[0m", "\u001B[35m6391a57f-7b59-4997-8459-1a8f88d3c0ab \u001B[33mSlay The Spire \u001B[32mcard rpg \u001B[33m20.0\u001B[0m", "\u001B[35m20cb8232-6515-4c2d-9046-acc990ab4c2d \u001B[33mCivilization 6 \u001B[32mstrategy \u001B[33m60.0\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We still develop the tool and it is not available in ",
          "type" : "SimpleText"
        }, {
          "code" : "PATH",
          "type" : "InlinedCode"
        }, {
          "text" : " yet, so we will need to use a relative path to run it.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Exposing the path to tests will make our tests brittle in the similar way how exposing UI elements definition does:",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "any time we change the tool location we will have to change tests using the tool.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Similar to UI Page Object idea, we declare CLI tools our tests need access to in a separate file/class:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package clicommands\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nclass CliCommands {\n    static final def adminTool = cli.command( // lazy declaration of our CLI command\n            \"java -jar ../../../../game-store-cli/target/admin-tool-jar-with-dependencies.jar\") // command line location is subject to change and should not be exposed to a test\n}",
        "title" : "Extracted CLI command definition",
        "excludeRegexp" : [ "Server", "backend" ],
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore\n\nimport static clicommands.CliCommands.* // convenient access to all declared command line tools\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nscenario('list games using CLI') {\n    // cleaning up DB\n    db.update(\"delete from GAME\")\n\n    // run our command line\n    adminTool.run {\n        output.should contain(\"List of games\")\n        // expect a title to be present, and nothing else\n        output.numberOfLines.should == 1\n    }\n\n    http.post(\"/api/game\", [title: \"Slay The Spire\", type: \"card rpg\", priceUsd: 20]) // pre-create data we need for the test using http layer\n    http.post(\"/api/game\", [title: \"Civilization 6\", type: \"strategy\", priceUsd: 60])\n\n    adminTool.run {\n        output.should contain(\"Slay The Spire\") // make sure output contains games we created\n        output.should contain(\"Civilization 6\")\n    }\n}",
        "title" : "Admin CLI tool test",
        "commentsType" : "inline",
        "excludeRegexp" : [ "cli.doc", "hide", "stop line" ],
        "type" : "Snippet"
      } ]
    }, {
      "title" : "TableData",
      "id" : "tabledata",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We have seen ",
          "type" : "SimpleText"
        }, {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " usage when we worked with Database and when we validated complex REST API output.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Let's take a closer look at it.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " is a core webtau data type. Think of it as a list of maps with extra functionality.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "You can assign ",
          "type" : "SimpleText"
        }, {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " to a variable, pass it around, return from functions and use for assertions.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Data is available at runtime, and it is not a compile-time construct.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Here is an example of usage of extra ",
          "type" : "SimpleText"
        }, {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " features to generate test data:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('table data demo') {\n    def increment = cell.above + 1 // create increment cell function to auto increase value\n    def tableData = [\"id\"      | \"name\" | \"score\"   | \"type\"               | \"disabled\"] {\n                    ____________________________________________________________________________\n                     cell.guid | \"A\"    | 100        | \"T0R\"               | false // cell.guid generates guid\n                     cell.guid | \"B\"    | cell.above | \"MBR\"               | true  // cell.above reuses value from the row above\n                     cell.guid | \"C\"    | increment  | permute(\"PO\", \"AC\") | permute(true, false) } // permute generates multiple rows based on the values passed\n\n    println(\"table data:\")\n    println(tableData)\n    println(tableData.collect { it.score }) // standard collection operations are available on table data\n}",
        "title" : "table data quick overview",
        "startLine" : "table-data-permute",
        "endLine" : "table-data-permute-end",
        "excludeStartEnd" : true,
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "title" : "Webtau Output",
        "startLine" : "table data demo",
        "endLine" : "100, 100",
        "lines" : [ "\u001B[34mtable data demo \u001B[35m(tableDataDemo.groovy)\u001B[0m", "table data:", ":id                                    |name|score|type |disabled:", ".______________________________________.____._____._____.________.", "|\"f982944c-3799-4738-b169-dfd85d588599\"|\"A\" |100  |\"T0R\"|false   |", ".______________________________________.____._____._____.________|", "|\"61a70270-afe4-4180-80d2-d5ab1b561758\"|\"B\" |100  |\"MBR\"|true    |", ".______________________________________.____._____._____.________|", "|\"e7cf8880-927d-4142-80db-2987c34b631e\"|\"C\" |101  |\"PO\" |true    |", ".______________________________________.____._____._____.________|", "|\"93033ad0-9d1e-4951-bad6-b76257df4a0c\"|\"C\" |102  |\"AC\" |true    |", ".______________________________________.____._____._____.________|", "|\"765b44c2-b0f7-4289-8641-425b56183778\"|\"C\" |103  |\"PO\" |false   |", ".______________________________________.____._____._____.________|", "|\"e003ace6-3d83-4861-a845-2adbfb1fcc8d\"|\"C\" |104  |\"AC\" |false   |", ".______________________________________.____._____._____.________|", "", "[100, 100, 101, 102, 103, 104]" ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "Can I Use TableData With JUnit?",
      "id" : "can-i-use-tabledata-with-junit",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "It is worth noting that ",
          "type" : "SimpleText"
        }, {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " is not specific to Groovy command line runner.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "In fact it can be used for example as JUnit5 test factory:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package com.example.junit5\n\nimport org.junit.jupiter.api.TestFactory\n\nclass DynamicTestsGroovyTest {\n    @TestFactory // Junit5 test factory that expects Stream<DynamicTest>\n    def \"test factory example\"() {\n        [\"price\" | \"quantity\" | \"outcome\"] {\n        ___________________________________\n              10 |  30        |  300\n             -10 |  30        | -300\n        }.test { // test is a what generates DynamicTest from each row\n            PriceCalculator.calculate(price, quantity).should == outcome\n        }\n    }\n}",
        "title" : "Table Data as Test Factory (Groovy)",
        "commentsType" : "inline",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Moreover, ",
          "type" : "SimpleText"
        }, {
          "code" : "TableData",
          "type" : "InlinedCode"
        }, {
          "text" : " is not specific to Groovy and you can use Java syntax to define an instance:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "java",
        "snippet" : "package com.example.junit5;\n\nimport org.junit.jupiter.api.DynamicTest;\nimport org.junit.jupiter.api.TestFactory;\nimport org.testingisdocumenting.webtau.data.table.TableData;\nimport org.testingisdocumenting.webtau.junit5.DynamicTests;\n\nimport java.util.stream.Stream;\n\nimport static org.testingisdocumenting.webtau.WebTauCore.*; // convenient single import for unit tests\n\nclass DynamicTestsJavaTest {\n    TableData useCases = table(\"price\", \"quantity\", \"outcome\", // java table definition\n                               ______________________________,\n                                   10 ,         30,       300,\n                                  -10 ,         30,      -300);\n    @TestFactory\n    public Stream<DynamicTest> testFactoryExample() {\n        return DynamicTests.fromTable(useCases, r -> { // generate DynamicTest per row\n            int price = r.get(\"price\");\n            int quantity = r.get(\"quantity\");\n            int outcome = r.get(\"outcome\");\n\n            actual(PriceCalculator.calculate(price, quantity)).should(equal(outcome));\n        });\n    }\n}",
        "title" : "Table Data as Test Factory (Java)",
        "commentsType" : "inline",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "Can I Use The Rest With JUnit?",
      "id" : "can-i-use-the-rest-with-junit",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Since we are talking about JUnit and Java, let me show you how to write a REST API test using JUnit5 and Java syntax:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "java",
        "snippet" : "package com.example.junit5;\n\nimport org.junit.jupiter.api.Test;\nimport org.testingisdocumenting.webtau.junit5.WebTau;\n\nimport java.util.Map;\n\nimport static org.testingisdocumenting.webtau.WebTauDsl.*; // convenient import for Java\n\n@WebTau // optional annotation to include this test into web report\npublic class PostGetJavaTest {\n    @Test\n    public void registerNewGame() {\n        Map<String, Object> payload = aMapOf( // define payload as a map\n                \"id\", \"g1\",\n                \"title\", \"Slay The Spire\",\n                \"type\", \"card rpg\",\n                \"priceUsd\", 20);\n\n        http.post(\"/api/game\", payload); // same post as in Groovy\n\n        http.get(\"/api/game/g1\", (header, body) -> {\n            body.get(\"title\").should(equal(\"Slay The Spire\")); // validating title field in the response\n        });\n    }\n}",
        "title" : "HTTP Post Get (Java)",
        "commentsType" : "inline",
        "meta" : {
          "stickySlide" : "left 70%"
        },
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In case of JUnit runner, webtau reads config values from ",
          "type" : "SimpleText"
        }, {
          "code" : "webtau.properties",
          "type" : "InlinedCode"
        }, {
          "text" : " resource file:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "properties",
        "snippet" : "url=http://localhost:8080",
        "title" : "src/test/resources/webtau.properties",
        "type" : "Snippet"
      } ]
    }, {
      "title" : "Reporting",
      "id" : "reporting",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "As I mentioned at the beginning, webtau captures a lot of information. Information is printed to the console, but",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "also stored in a rich HTML report.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Generated report is a self-contained HTML file that can be emailed, slacked or copied to a network drive. You don't need",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "to have a server to look at the report. Open it in a browser, and you will get an interactive mini app.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-report-summary.json",
        "imageSrc" : "/blog/game-store-report-summary.png",
        "timestamp" : 1604379675113,
        "shapes" : [ {
          "id" : "circle1",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 366,
          "y" : 123,
          "r" : 15
        }, {
          "id" : "circle2",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 366,
          "y" : 293,
          "r" : 15
        }, {
          "id" : "circle3",
          "type" : "circle",
          "text" : "3",
          "color" : "a",
          "x" : 366,
          "y" : 463,
          "r" : 15
        }, {
          "id" : "circle4",
          "type" : "circle",
          "text" : "4",
          "color" : "a",
          "x" : 366,
          "y" : 633,
          "r" : 15
        }, {
          "id" : "circle5",
          "type" : "circle",
          "text" : "5",
          "color" : "a",
          "x" : 366,
          "y" : 803,
          "r" : 15
        }, {
          "id" : "circle6",
          "type" : "circle",
          "text" : "6",
          "color" : "a",
          "x" : 868,
          "y" : 496,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Report Summary page consist of",
          "type" : "SimpleText"
        } ]
      }, {
        "delimiter" : ".",
        "startNumber" : 1,
        "type" : "OrderedList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "type" : "StrongEmphasis",
              "content" : [ {
                "text" : "Tests Runtime",
                "type" : "SimpleText"
              } ]
            }, {
              "text" : " - shows overall time spend",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "type" : "StrongEmphasis",
              "content" : [ {
                "text" : "Tests success ratio",
                "type" : "SimpleText"
              } ]
            }, {
              "text" : " - how many failed vs passed",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "type" : "StrongEmphasis",
              "content" : [ {
                "text" : "HTTP Coverage",
                "type" : "SimpleText"
              } ]
            }, {
              "text" : " - how many REST API operations are covered (webtau uses optional Open API spec url to discover all the operations)",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "type" : "StrongEmphasis",
              "content" : [ {
                "text" : "Tests run Ratio",
                "type" : "SimpleText"
              } ]
            }, {
              "text" : " - how many skipped vs ran",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "type" : "StrongEmphasis",
              "content" : [ {
                "text" : "HTTP calls time",
                "type" : "SimpleText"
              } ]
            }, {
              "text" : " - high level stats on HTTP based APIs",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's click on (",
          "type" : "SimpleText"
        }, {
          "code" : "6",
          "type" : "InlinedCode"
        }, {
          "text" : ") to get more details about skipped operations:",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-skipped-operations.json",
        "imageSrc" : "/blog/game-store-skipped-operations.png",
        "timestamp" : 1604379676326,
        "shapes" : [ {
          "id" : "circle7",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 333,
          "y" : 16,
          "r" : 15
        }, {
          "id" : "circle8",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 16,
          "y" : 120,
          "r" : 15
        }, {
          "id" : "circle9",
          "type" : "circle",
          "text" : "3",
          "color" : "a",
          "x" : 808,
          "y" : 496,
          "r" : 15
        }, {
          "id" : "circle10",
          "type" : "circle",
          "text" : "4",
          "color" : "a",
          "x" : 50,
          "y" : 862,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Report switched from ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "Tests",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " view to ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "HTTP Calls",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " view (",
          "type" : "SimpleText"
        }, {
          "code" : "1",
          "type" : "InlinedCode"
        }, {
          "text" : ").",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "You can see the list of operations we yet to test on the left (",
          "type" : "SimpleText"
        }, {
          "code" : "2",
          "type" : "InlinedCode"
        }, {
          "text" : ").",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Number of items on the left matches the number in the summary card (",
          "type" : "SimpleText"
        }, {
          "code" : "3",
          "type" : "InlinedCode"
        }, {
          "text" : ").",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "We can use panel at the bottom (",
          "type" : "SimpleText"
        }, {
          "code" : "4",
          "type" : "InlinedCode"
        }, {
          "text" : ") to switch between skipped, total, passed operations or tests.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's navigate from ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "Summary",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab to ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "Overal HTTP Performance",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab. The screen shows high level picture of",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "how performant our server is under test load. While it is not a true performance test, it may give you an initial glance into",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "things that may need a closer look.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-overall-http-performance.json",
        "imageSrc" : "/blog/game-store-overall-http-performance.png",
        "timestamp" : 1604379677275,
        "shapes" : [ {
          "id" : "circle11",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 657,
          "y" : 34,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "HTTP Operations Performance",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab provides a performance information based on Open API defined operations.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-operations-http-performance.json",
        "imageSrc" : "/blog/game-store-operations-http-performance.png",
        "timestamp" : 1604379678037,
        "shapes" : [ {
          "id" : "circle12",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 869,
          "y" : 34,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Let's get back to ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "tests",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " view (",
          "type" : "SimpleText"
        }, {
          "code" : "1",
          "type" : "InlinedCode"
        }, {
          "text" : ") and select a test (",
          "type" : "SimpleText"
        }, {
          "code" : "2",
          "type" : "InlinedCode"
        }, {
          "text" : ").",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "First screen we are going to see is a test ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "Summary",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " (",
          "type" : "SimpleText"
        }, {
          "code" : "3",
          "type" : "InlinedCode"
        }, {
          "text" : ") with high level information on time taken.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-report-test-summary.json",
        "imageSrc" : "/blog/game-store-report-test-summary.png",
        "timestamp" : 1604379678975,
        "shapes" : [ {
          "id" : "circle13",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 231,
          "y" : 16,
          "r" : 15
        }, {
          "id" : "circle14",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 191,
          "y" : 622,
          "r" : 15
        }, {
          "id" : "circle15",
          "type" : "circle",
          "text" : "3",
          "color" : "a",
          "x" : 396,
          "y" : 34,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If a test performed any HTTP calls, you going to see the ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "HTTP Calls",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab (",
          "type" : "SimpleText"
        }, {
          "code" : "1",
          "type" : "InlinedCode"
        }, {
          "text" : "). It contains every HTTP call performed",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "with captured request, response and assertions (",
          "type" : "SimpleText"
        }, {
          "code" : "2",
          "type" : "InlinedCode"
        }, {
          "text" : " and ",
          "type" : "SimpleText"
        }, {
          "code" : "3",
          "type" : "InlinedCode"
        }, {
          "text" : ") information.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-report-http-call.json",
        "imageSrc" : "/blog/game-store-report-http-call.png",
        "timestamp" : 1604379679911,
        "shapes" : [ {
          "id" : "circle16",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 491,
          "y" : 34,
          "r" : 15
        }, {
          "id" : "circle17",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 1000,
          "y" : 280,
          "r" : 15
        }, {
          "id" : "circle18",
          "type" : "circle",
          "text" : "3",
          "color" : "a",
          "x" : 987,
          "y" : 377,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "If a test performed any CLI calls, you going to see the ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "CLI Calls",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab (",
          "type" : "SimpleText"
        }, {
          "code" : "1",
          "type" : "InlinedCode"
        }, {
          "text" : "). It contains every CLI call performed",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "with captured command, output and assertions (",
          "type" : "SimpleText"
        }, {
          "code" : "2",
          "type" : "InlinedCode"
        }, {
          "text" : ") information.",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-report-cli-call.json",
        "imageSrc" : "/blog/game-store-report-cli-call.png",
        "timestamp" : 1604379680908,
        "shapes" : [ {
          "id" : "circle19",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 585,
          "y" : 34,
          "r" : 15
        }, {
          "id" : "circle20",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 447,
          "y" : 200,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Every test also has ",
          "type" : "SimpleText"
        }, {
          "type" : "StrongEmphasis",
          "content" : [ {
            "text" : "Steps",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " tab (",
          "type" : "SimpleText"
        }, {
          "code" : "1",
          "type" : "InlinedCode"
        }, {
          "text" : ") that contains every step test performed, time it took, and what Persona if any",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "performed the step (",
          "type" : "SimpleText"
        }, {
          "code" : "2",
          "type" : "InlinedCode"
        }, {
          "text" : " and ",
          "type" : "SimpleText"
        }, {
          "code" : "3",
          "type" : "InlinedCode"
        }, {
          "text" : ")",
          "type" : "SimpleText"
        } ]
      }, {
        "annotationsPath" : "game-store-report-steps.json",
        "imageSrc" : "/blog/game-store-report-steps.png",
        "timestamp" : 1604379681871,
        "shapes" : [ {
          "id" : "circle21",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 576,
          "y" : 34,
          "r" : 15
        }, {
          "id" : "circle22",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 366,
          "y" : 75,
          "r" : 15
        }, {
          "id" : "circle23",
          "type" : "circle",
          "text" : "3",
          "color" : "a",
          "x" : 366,
          "y" : 357,
          "r" : 15
        } ],
        "width" : 1200.0,
        "height" : 877.0,
        "type" : "AnnotatedImage"
      } ]
    }, {
      "title" : "REPL",
      "id" : "repl",
      "type" : "Section",
      "content" : [ {
        "type" : "BlockQuote",
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "REPL stands for read-eval-print-loop. It is an interactive computer programming environment that helps with",
            "type" : "SimpleText"
          }, {
            "type" : "SoftLineBreak"
          }, {
            "text" : "prototyping.",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "You may have already used REPL if you used",
          "type" : "SimpleText"
        } ]
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Jupyter Notebook",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "iPython",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "R",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "MatLab",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "revealLineStop" : [ 0, 1, 2, 3, 4 ],
        "meta" : {
          "stickySlide" : "left 30%"
        },
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m 2 + 2", "\u001B[1m===>\u001B[m 4", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m a = 5", "\u001B[1m===>\u001B[m 5", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m a + 3", "\u001B[1m===>\u001B[m 8" ],
        "type" : "CliOutput"
      }, {
        "stickySlide" : "top 30%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Question: Why are we talking about REPL in the context of end to end testing?",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We want to have a fast feedback loop.",
          "type" : "SimpleText"
        } ]
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Browser, Servers, DB setup takes time",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Preserving context",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "End to end tests - slow feedback",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "REPL - speedup feedback loop",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "The faster feedback the happier you are",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      } ]
    }, {
      "title" : "REPL Browser",
      "id" : "repl-browser",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Writing UI tests can be time-consuming. One of the reason is it takes time to open a browser,",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "run your test, add an extra line to the test, repeat.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Instead we can run webtau in repl mode like this",
          "type" : "SimpleText"
        } ]
      }, {
        "command" : "webtau repl",
        "paramsToHighlight" : [ ],
        "type" : "CliCommand"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "after that we can execute one command at a time, preserving context",
          "type" : "SimpleText"
        } ]
      }, {
        "revealLineStop" : [ 0, 3, 4, 7, 8, 14, 15, 18, 19, 23, 24 ],
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m browser.open(\"https://google.com\")", "\u001B[34mpreparing \u001B[33mchrome\u001B[34m WebDriver\u001B[0m", "\u001B[33m> \u001B[34mopening \u001B[35mhttps://google.com\u001B[0m", "\u001B[32m. \u001B[34mopened \u001B[35mhttps://google.com\u001B[33m (\u001B[32m459ms\u001B[33m)\u001B[0m", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m $('input[title=\"Search\"]')", "\u001B[32melement is found: \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "\u001B[33m           getText(): \u001B[32m\u001B[0m", "\u001B[33mgetUnderlyingValue(): \u001B[32m\u001B[0m", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m $('input[title=\"Search\"]').setValue(\"test\\n\")", "\u001B[33m> \u001B[34msetting value \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[33m> \u001B[34mclearing \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[32m. \u001B[34mcleared \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m37ms\u001B[33m)\u001B[0m", "  \u001B[33m> \u001B[34msending keys \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "  \u001B[32m. \u001B[34msent keys \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m1s 987ms\u001B[33m)\u001B[0m", "\u001B[32m. \u001B[34mset value \u001B[32mtest\\n \u001B[33mto \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[33m (\u001B[32m2s 45ms\u001B[33m)\u001B[0m", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m $('input[title=\"Search\"]')", "\u001B[32melement is found: \u001B[35mby css \u001B[1m\u001B[35minput[title=\"Search\"]\u001B[0m", "\u001B[33m           getText(): \u001B[32m\u001B[0m", "\u001B[33mgetUnderlyingValue(): \u001B[32mtest\u001B[0m", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m $('h3')", "\u001B[32melement is found: \u001B[35mby css \u001B[1m\u001B[35mh3\u001B[0m", "\u001B[33m           getText(): \u001B[32mSpeedtest by Ookla - The Global Broadband Speed Test\u001B[0m", "\u001B[33mgetUnderlyingValue(): \u001B[32mSpeedtest by Ookla - The Global Broadband Speed Test\u001B[0m", "\u001B[33m               count: \u001B[32m15\u001B[0m", "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m $('h3').count.waitTo >= 0", "\u001B[33m> \u001B[34mwaiting \u001B[33mto \u001B[36mcount \u001B[33mof \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[32mto be greater than or equal to 0\u001B[0m", "\u001B[32m. \u001B[36mcount \u001B[33mof \u001B[35mby css \u001B[1m\u001B[35mh3 \u001B[32mgreater than or equal 0", "    matches:", "    ", "    count:   actual: 15 <java.lang.Integer>", "           expected: greater than or equal to 0 <java.lang.Integer>\u001B[33m (\u001B[32m7ms\u001B[33m)\u001B[0m" ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "REPL Database",
      "id" : "repl-database",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Database layer can be used to semi-automatically validate state of your system during experimentation.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Or it can be used to quickly wipe or setup the data. I personally use it during active development to iterate faster.",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "DB REPL",
        "revealLineStop" : [ 0 ],
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m db.query(\"select * from Game\")", "\u001B[33m> \u001B[34mrunning DB query \u001B[32mselect * from Game \u001B[33mon \u001B[0m\u001B[1mprimary-db\u001B[0m", "\u001B[32m. \u001B[34mran DB query \u001B[32mselect * from Game \u001B[33mon \u001B[0m\u001B[1mprimary-db\u001B[33m (\u001B[32m29ms\u001B[33m)\u001B[0m", "\u001B[33mID  \u001B[33m, \u001B[0m\u001B[33mPRICE_USD\u001B[33m, \u001B[0m\u001B[33mTITLE           \u001B[33m, \u001B[0m\u001B[33mTYPE      \u001B[0m", "\"g1\"\u001B[33m, \u001B[0m\u001B[36m    20.00\u001B[0m\u001B[33m, \u001B[0m\"Slay The Spire\"\u001B[33m, \u001B[0m\"card rpg\"", "\"g2\"\u001B[33m, \u001B[0m\u001B[36m    40.00\u001B[0m\u001B[33m, \u001B[0m\"Doom\"          \u001B[33m, \u001B[0m\"fps\"     " ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "REPL Test Selection",
      "id" : "repl-test-selection",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "The true power of webtau REPL mode comes from combining Test runs and experimentation in one go.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "We can run webtau in repl mode and at the same time pass the test files we want to work with:",
          "type" : "SimpleText"
        } ]
      }, {
        "command" : "webtau scenarios/gamestore/adminCliTool.groovy scenarios/gamestore/userPreferencesRest.groovy scenarios/gamestore/userPreferencesGraphQL.groovy scenarios/gamestore/userPreferencesUi.groovy repl",
        "paramsToHighlight" : [ ],
        "meta" : {
          "stickySlide" : "top 30%"
        },
        "type" : "CliCommand"
      }, {
        "title" : "Test files listing",
        "revealLineStop" : [ 0 ],
        "meta" : {
          "stickySlide" : "left"
        },
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m ls", "\u001B[34mTest files:\u001B[0m", "\u001B[33m0\u001B[35m scenarios/gamestore/adminCliTool.groovy\u001B[0m", "\u001B[33m1\u001B[35m scenarios/gamestore/userPreferencesRest.groovy\u001B[0m", "\u001B[33m2\u001B[35m scenarios/gamestore/userPreferencesGraphQL.groovy\u001B[0m", "\u001B[33m3\u001B[35m scenarios/gamestore/userPreferencesUi.groovy\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Once you list all test files, you can select one by ",
          "type" : "SimpleText"
        }, {
          "url" : "https://testingisdocumenting.org/webtau/REPL/test-runs#test-file-selection",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "either index or text",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "title" : "Test file selection",
        "revealLineStop" : [ 0 ],
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m s \"userPreferencesRest\"", "\u001B[34mTest scenarios of \u001B[35mscenarios/gamestore/userPreferencesRest.groovy\u001B[34m:\u001B[0m", "\u001B[33m0\u001B[35m save preferences without auth\u001B[0m", "\u001B[33m1\u001B[35m save preferences with explicit auth\u001B[0m", "\u001B[33m2\u001B[35m save preferences with personas auth\u001B[0m", "\u001B[33m3\u001B[35m read preferences with personas auth\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "After test file selection, you can run one or more scenarios on demand.",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "Test ran, context is preserved",
        "revealLineStop" : [ 0 ],
        "endLine" : "Bob",
        "excludeRegexp" : [ "before first test" ],
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m r \"save preferences with personas auth\"", "\u001B[0m", "\u001B[34mrunning: \u001B[35mscenarios/gamestore/userPreferencesRest.groovy \u001B[33msave preferences with personas auth\u001B[0m", "\u001B[34msave preferences with personas auth \u001B[35m(userPreferencesRest.groovy)\u001B[0m", "\u001B[33m> \u001B[33mAlice \u001B[0m\u001B[34mexecuting HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[0m", "\u001B[33mrequest\u001B[36m (application/json):\u001B[0m", "\u001B[33m{\u001B[0m", "  \u001B[35m\"favoriteGenre\": \u001B[32m\"RPG\"\u001B[0m", "\u001B[33m}\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mbody.userId \u001B[32mequals \"uid-alice\"", "      matches:", "      ", "      body.userId:   actual: \"uid-alice\" <java.lang.String>", "                   expected: \"uid-alice\" <java.lang.String>\u001B[33m (\u001B[32m18ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mbody.favoriteGenre \u001B[32mequals \"RPG\"", "      matches:", "      ", "      body.favoriteGenre:   actual: \"RPG\" <java.lang.String>", "                          expected: \"RPG\" <java.lang.String>\u001B[33m (\u001B[32m0ms\u001B[33m)\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[0m\u001B[1mheader.statusCode \u001B[32mequals 200", "      matches:", "      ", "      header.statusCode:   actual: 200 <java.lang.Integer>", "                         expected: 200 <java.lang.Integer>\u001B[33m (\u001B[32m1ms\u001B[33m)\u001B[0m", "  \u001B[33m> \u001B[33mAlice \u001B[0m\u001B[34mvalidating \u001B[36mrequest and response\u001B[0m", "  \u001B[32m. \u001B[33mAlice \u001B[0m\u001B[34mvalidated \u001B[36mrequest and response\u001B[33m (\u001B[32m149ms\u001B[33m)\u001B[0m", "\u001B[33mresponse\u001B[36m (application/json):\u001B[0m", "\u001B[33m{\u001B[0m", "  \u001B[35m\"userId\": \u001B[32m\u001B[1m\u001B[32m__\"uid-alice\"__\u001B[33m,\u001B[0m", "  \u001B[35m\"favoriteGenre\": \u001B[32m\u001B[1m\u001B[32m__\"RPG\"__\u001B[0m", "\u001B[33m}\u001B[0m", "\u001B[32m. \u001B[33mAlice \u001B[0m\u001B[34mexecuted HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[33m (\u001B[32m320ms\u001B[33m)\u001B[0m", "\u001B[33m> \u001B[33mBob \u001B[0m\u001B[34mexecuting HTTP PUT \u001B[35mhttp://localhost:8080/api/user-preferences\u001B[0m" ],
        "type" : "CliOutput"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "When I write tests, I keep re-running (",
          "type" : "SimpleText"
        }, {
          "code" : "r",
          "type" : "InlinedCode"
        }, {
          "text" : ") a current test under development, then experiment with a few lines in REPL mode,",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "do some checks, update the test file and re-run it (",
          "type" : "SimpleText"
        }, {
          "code" : "r",
          "type" : "InlinedCode"
        }, {
          "text" : "). Webtau will reload test file and pickup your changes.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "After each test run, context is preserved, browser is open in the last location, DB is up to date, and REST/GraphQL APIs are primed.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Here is an example of running a ",
          "type" : "SimpleText"
        }, {
          "code" : "db.",
          "type" : "InlinedCode"
        }, {
          "text" : " query after a test run:",
          "type" : "SimpleText"
        } ]
      }, {
        "title" : "Experiments after a test run",
        "revealLineStop" : [ 0 ],
        "lines" : [ "\u001B[1mwebtau:\u001B[m000\u001B[1m>\u001B[m db.query(\"select * from user_preferences\")", "\u001B[33m> \u001B[34mrunning DB query \u001B[32mselect * from user_preferences \u001B[33mon \u001B[0m\u001B[1mprimary-db\u001B[0m", "\u001B[32m. \u001B[34mran DB query \u001B[32mselect * from user_preferences \u001B[33mon \u001B[0m\u001B[1mprimary-db\u001B[33m (\u001B[32m30ms\u001B[33m)\u001B[0m", "\u001B[33mUSER_ID    \u001B[33m, \u001B[0m\u001B[33mFAVORITE_GENRE\u001B[0m", "\"user-a\"   \u001B[33m, \u001B[0m\"RPG\"         ", "\"uid-alice\"\u001B[33m, \u001B[0m\"RPG\"         ", "\"uid-bob\"  \u001B[33m, \u001B[0m\"Strategy\"    ", "\u001B[0m" ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "Testing is Documenting",
      "id" : "testing-is-documenting",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "When we document things, we try them out and make sure they work as intended.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "When we test things, we follow happy paths and edge cases.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Happy path tests often cover what our users will do. Happy path tests also often match the things we document.",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationBulletListType" : "HorizontalStripes",
        "presentationParagraph" : "default",
        "stickySlide" : "top 50%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Documentation is hard:",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationParagraph" : "",
        "type" : "Meta"
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "id" : "pen-tool",
              "type" : "Icon"
            }, {
              "text" : " Mostly manual labor",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "id" : "archive",
              "type" : "Icon"
            }, {
              "text" : " Often becomes outdated",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "presentationBulletListType" : "HorizontalStripes",
        "stickySlide" : "clear top 30%",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Question: How do we make documentation easier to write and maintain?",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationParagraph" : "",
        "stickySlide" : "top 40%",
        "type" : "Meta"
      }, {
        "type" : "BlockQuote",
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "Artifacts capture",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "We already have things in our codebase that we can use to help with our product documentation. Example",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "code snippets, GraphQL schema files, basic config files.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "By writing happy path tests we can add a few more to the list:",
          "type" : "SimpleText"
        } ]
      }, {
        "presentationBulletListType" : "RevealBoxes",
        "type" : "Meta"
      }, {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "CLI Outputs",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "HTTP responses",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "Screenshots",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      }, {
        "stickySlide" : "clear",
        "type" : "Meta"
      }, {
        "type" : "BlockQuote",
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "The major part of this content was generated by running tests",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Webtau console outputs your saw, the REST/GraphQL API response, Game Store and Webtau Report screenshots, all of it was",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "automatially generated by running tests.",
          "type" : "SimpleText"
        } ]
      } ]
    }, {
      "title" : "Capturing Test Artifacts",
      "id" : "capturing-test-artifacts",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "When I was showing your snippets of code before I was hidding some code from your.",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "Let's take a look.",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('db write and http list games') {\n    db.update(\"delete from Game\")\n\n    def GAME = db.table(\"GAME\")\n    GAME << [\"ID\" | \"TITLE\"           | \"TYPE\"     | \"PRICE_USD\"] {\n             ____________________________________________________\n             \"g1\" | \"Slay The Spire\"  | \"card rpg\" | 20\n             \"g2\" | \"Civilization 6\"  | \"strategy\" | 60  }\n\n    http.get(\"/api/game\") {\n        body.should == [ \"*id\" | \"title\" ] {\n                       ___________________________\n                          \"g2\" | \"Civilization 6\"\n                          \"g1\" | \"Slay The Spire\" }\n    }\n    http.doc.capture(\"game-store-list-after-db\")\n}",
        "title" : "HTTP doc capture",
        "startLine" : "db-insert",
        "endLine" : "scenario-end",
        "excludeStartEnd" : true,
        "highlight" : [ 15 ],
        "excludeRegexp" : [ "//" ],
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "code" : "http.doc.capture",
          "type" : "InlinedCode"
        }, {
          "text" : " generates a directory with captured response, request, url, assertions, etc",
          "type" : "SimpleText"
        } ]
      }, {
        "scaleRatio" : 0.5,
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "imageSrc" : "/blog/articles/img/ue2e-ide-doc-artifacts.png",
        "timestamp" : 1604443298292,
        "shapes" : [ ],
        "width" : 467.0,
        "height" : 607.0,
        "type" : "AnnotatedImage"
      }, {
        "lang" : "txt",
        "snippet" : "/api/game",
        "title" : "game-store-list-after-db/request.url.txt",
        "meta" : {
          "stickySlide" : "top 20%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "json",
        "snippet" : "[ {\n  \"id\" : \"g1\",\n  \"title\" : \"Slay The Spire\",\n  \"type\" : \"card rpg\",\n  \"priceUsd\" : 20.0\n}, {\n  \"id\" : \"g2\",\n  \"title\" : \"Civilization 6\",\n  \"type\" : \"strategy\",\n  \"priceUsd\" : 60.0\n} ]",
        "title" : "game-store-list-after-db/response.json",
        "meta" : {
          "stickySlide" : "top 70%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "json",
        "snippet" : "[\"root[0].id\",\"root[0].title\",\"root[1].id\",\"root[1].title\"]",
        "title" : "game-store-list-after-db/paths.json",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "To capture screenshots webtau has ",
          "type" : "SimpleText"
        }, {
          "code" : "browser.doc.capture",
          "type" : "InlinedCode"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "scenario('filter by price') {\n    landing.reopen()\n    landing.filterBelow60.setValue(true)\n\n    landing.titles.waitTo == ['Assassin Creed Odyssey', 'Division 2',\n                              'Hearthstone', 'Inside', 'Slay The Spire']\n    browser.doc.withAnnotations(\n            browser.doc.badge(landing.filterText).toTheRight(),\n            browser.doc.badge(landing.labelBelow60).toTheRight())\n            .capture('admin-ui-filter')\n}",
        "title" : "UI doc capture",
        "startLine" : "filter by price",
        "highlight" : [ 6 ],
        "excludeRegexp" : [ "hide", "//" ],
        "meta" : {
          "stickySlide" : "left 50%"
        },
        "type" : "Snippet"
      }, {
        "annotationsPath" : "admin-ui-filter.json",
        "title" : "admin-ui-filter.json",
        "caption" : "admin-ui-filter.png",
        "meta" : {
          "stickySlide" : "top 40%"
        },
        "imageSrc" : "/blog/admin-ui-filter.png",
        "timestamp" : 1604986282688,
        "shapes" : [ {
          "id" : "circle1",
          "type" : "circle",
          "text" : "1",
          "color" : "a",
          "x" : 224,
          "y" : 88,
          "r" : 15
        }, {
          "id" : "circle2",
          "type" : "circle",
          "text" : "2",
          "color" : "a",
          "x" : 345,
          "y" : 88,
          "r" : 15
        } ],
        "width" : 1000.0,
        "height" : 677.0,
        "type" : "AnnotatedImage"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In addition to the screenshot ",
          "type" : "SimpleText"
        }, {
          "code" : ".png",
          "type" : "InlinedCode"
        }, {
          "text" : " file webtau also captures annotations placement and type:",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "json",
        "snippet" : "{\n  \"shapes\" : [ {\n    \"id\" : \"circle1\",\n    \"type\" : \"circle\",\n    \"text\" : \"1\",\n    \"color\" : \"a\",\n    \"x\" : 224,\n    \"y\" : 88,\n    \"r\" : 15\n  }, {\n    \"id\" : \"circle2\",\n    \"type\" : \"circle\",\n    \"text\" : \"2\",\n    \"color\" : \"a\",\n    \"x\" : 345,\n    \"y\" : 88,\n    \"r\" : 15\n  } ],\n  \"pixelRatio\" : 2\n}",
        "title" : "admin-ui-filter.json",
        "type" : "Snippet"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "In case of ",
          "type" : "SimpleText"
        }, {
          "code" : "CLI",
          "type" : "InlinedCode"
        }, {
          "text" : " ",
          "type" : "SimpleText"
        }, {
          "code" : "cli.doc.capture",
          "type" : "InlinedCode"
        }, {
          "text" : " captures the command that was run, its output and assertions performed",
          "type" : "SimpleText"
        } ]
      }, {
        "lang" : "groovy",
        "snippet" : "package scenarios.gamestore\n\nimport static org.testingisdocumenting.webtau.WebTauGroovyDsl.*\n\nscenario('list games using CLI') {\n    db.update(\"delete from GAME\")\n\n    adminTool.run {\n        output.should contain(\"List of games\")\n        output.numberOfLines.should == 1\n    }\n\n    http.post(\"/api/game\", [title: \"Civilization 6\", type: \"strategy\", priceUsd: 60])\n\n    adminTool.run {\n        output.should contain(\"Civilization 6\")\n    }\n    cli.doc.capture(\"list-games-cli\")\n}",
        "title" : "CLI doc capture",
        "excludeRegexp" : [ "//" ],
        "highlight" : [ 17 ],
        "meta" : {
          "stickySlide" : "left 40%"
        },
        "type" : "Snippet"
      }, {
        "lang" : "txt",
        "snippet" : "java -jar ../../../../game-store-cli/target/admin-tool-jar-with-dependencies.jar",
        "title" : "list-games-cli/command.txt",
        "meta" : {
          "stickySlide" : "top"
        },
        "type" : "Snippet"
      }, {
        "title" : "list-games-cli/out.txt",
        "lines" : [ "\u001B[36mList of games\u001B[0m", "\u001B[35m6391a57f-7b59-4997-8459-1a8f88d3c0ab \u001B[33mSlay The Spire \u001B[32mcard rpg \u001B[33m20.0\u001B[0m", "\u001B[35m20cb8232-6515-4c2d-9046-acc990ab4c2d \u001B[33mCivilization 6 \u001B[32mstrategy \u001B[33m60.0\u001B[0m" ],
        "type" : "CliOutput"
      } ]
    }, {
      "title" : "Example of Generated Documentation",
      "id" : "example-of-generated-documentation",
      "type" : "Section",
      "content" : [ {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "I used the captured information to generate the content of this blog/presentation. At my work I use captured artifacts",
          "type" : "SimpleText"
        }, {
          "type" : "SoftLineBreak"
        }, {
          "text" : "to produce user guides. This approach makes guides to be always up-to date and validated.",
          "type" : "SimpleText"
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Here is an example of Game Store manual created with captured artifacts and ",
          "type" : "SimpleText"
        }, {
          "url" : "https://testingisdocumenting.org/znai/",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "Znai",
            "type" : "SimpleText"
          } ]
        }, {
          "text" : " documentation system.",
          "type" : "SimpleText"
        } ]
      }, {
        "scaleRatio" : 0.5,
        "border" : true,
        "imageSrc" : "/blog/game-store-docs-web-ui.png",
        "timestamp" : 1604461671567,
        "shapes" : [ ],
        "width" : 1322.0,
        "height" : 841.0,
        "type" : "AnnotatedImage"
      }, {
        "scaleRatio" : 0.5,
        "border" : true,
        "imageSrc" : "/blog/game-store-docs-rest-api.png",
        "timestamp" : 1604461672368,
        "shapes" : [ ],
        "width" : 1322.0,
        "height" : 841.0,
        "type" : "AnnotatedImage"
      }, {
        "scaleRatio" : 0.5,
        "border" : true,
        "imageSrc" : "/blog/game-store-docs-cli.png",
        "timestamp" : 1604461673113,
        "shapes" : [ ],
        "width" : 1322.0,
        "height" : 841.0,
        "type" : "AnnotatedImage"
      } ]
    }, {
      "title" : "Summary",
      "id" : "summary",
      "type" : "Section",
      "content" : [ {
        "bulletMarker" : "*",
        "tight" : true,
        "type" : "BulletList",
        "content" : [ {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "We tested Game Store on multiple layers, using one layer to set-up and re-inforce tests on the other layers.",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "We used consistent matchers and concepts like ",
              "type" : "SimpleText"
            }, {
              "code" : "should",
              "type" : "InlinedCode"
            }, {
              "text" : ", ",
              "type" : "SimpleText"
            }, {
              "code" : "waitTo",
              "type" : "InlinedCode"
            }, {
              "text" : ", ",
              "type" : "SimpleText"
            }, {
              "code" : "Persona",
              "type" : "InlinedCode"
            }, {
              "text" : " across layers.",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "We saw how each step and assertions is captured by webtau and written to console and rich HTML report.",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "We saw how REPL can improve feedback loop and make you write tests faster.",
              "type" : "SimpleText"
            } ]
          } ]
        }, {
          "type" : "ListItem",
          "content" : [ {
            "type" : "Paragraph",
            "content" : [ {
              "text" : "We saw how writing tests can generate artifacts to help you with writing User facing documentation.",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      } ]
    }, {
      "title" : "To Get Started",
      "id" : "to-get-started",
      "type" : "Section",
      "content" : [ {
        "presentationParagraph" : "default",
        "stickySlide" : "top",
        "type" : "Meta"
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "WebTau - GitHub: ",
          "type" : "SimpleText"
        }, {
          "url" : "https://github.com/testingisdocumenting/webtau",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "https://github.com/testingisdocumenting/webtau",
            "type" : "SimpleText"
          } ]
        }, {
          "type" : "SoftLineBreak"
        }, {
          "type" : "HardLineBreak"
        }, {
          "text" : "WebTau - User Guide: ",
          "type" : "SimpleText"
        }, {
          "url" : "https://testingisdocumenting.org/webtau",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "https://testingisdocumenting.org/webtau",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "type" : "Paragraph",
        "content" : [ {
          "text" : "Znai - Github: ",
          "type" : "SimpleText"
        }, {
          "url" : "https://github.com/testingisdocumenting/znai",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "https://github.com/testingisdocumenting/znai",
            "type" : "SimpleText"
          } ]
        }, {
          "type" : "SoftLineBreak"
        }, {
          "type" : "HardLineBreak"
        }, {
          "text" : "Znai - User Guide: ",
          "type" : "SimpleText"
        }, {
          "url" : "https://testingisdocumenting.org/znai",
          "isFile" : false,
          "type" : "Link",
          "content" : [ {
            "text" : "https://testingisdocumenting.org/znai",
            "type" : "SimpleText"
          } ]
        } ]
      } ]
    } ],
    "lastModifiedTime" : 1605075063830,
    "tocItem" : {
      "sectionTitle" : "Entry",
      "pageTitle" : "Ultimate End To End Test",
      "pageMeta" : {
        "date" : [ "2020-10-30" ],
        "summary" : [ "End to end of REST API, Command Line Interface, Web User Interface and Database" ]
      },
      "dirName" : "entry",
      "fileName" : "ultimate-end-to-end-test",
      "viewOnRelativePath" : "articles/ultimate-end-to-end-test.md",
      "pageSectionIdTitles" : [ {
        "title" : "WebTau",
        "id" : "webtau"
      }, {
        "title" : "Game Store",
        "id" : "game-store"
      }, {
        "title" : "WebTau Introduction",
        "id" : "webtau-introduction"
      }, {
        "title" : "Basic Configuration",
        "id" : "basic-configuration"
      }, {
        "title" : "Game Store REST API",
        "id" : "game-store-rest-api"
      }, {
        "title" : "HTTP Explicit Auth",
        "id" : "http-explicit-auth"
      }, {
        "title" : "Personas",
        "id" : "personas"
      }, {
        "title" : "HTTP Implicit Auth",
        "id" : "http-implicit-auth"
      }, {
        "title" : "GraphQL",
        "id" : "graphql"
      }, {
        "title" : "GraphQL Explicit Auth",
        "id" : "graphql-explicit-auth"
      }, {
        "title" : "GraphQL Persona Auth",
        "id" : "graphql-persona-auth"
      }, {
        "title" : "Personas Re-use",
        "id" : "personas-re-use"
      }, {
        "title" : "Browser",
        "id" : "browser"
      }, {
        "title" : "Game Store UI",
        "id" : "game-store-ui"
      }, {
        "title" : "UI Page Object",
        "id" : "ui-page-object"
      }, {
        "title" : "WaitTo",
        "id" : "waitto"
      }, {
        "title" : "Browser Explicit Auth",
        "id" : "browser-explicit-auth"
      }, {
        "title" : "Browser Implicit Auth",
        "id" : "browser-implicit-auth"
      }, {
        "title" : "Browser WebSocket",
        "id" : "browser-websocket"
      }, {
        "title" : "Database",
        "id" : "database"
      }, {
        "title" : "CLI Command",
        "id" : "cli-command"
      }, {
        "title" : "TableData",
        "id" : "tabledata"
      }, {
        "title" : "Can I Use TableData With JUnit?",
        "id" : "can-i-use-tabledata-with-junit"
      }, {
        "title" : "Can I Use The Rest With JUnit?",
        "id" : "can-i-use-the-rest-with-junit"
      }, {
        "title" : "Reporting",
        "id" : "reporting"
      }, {
        "title" : "REPL",
        "id" : "repl"
      }, {
        "title" : "REPL Browser",
        "id" : "repl-browser"
      }, {
        "title" : "REPL Database",
        "id" : "repl-database"
      }, {
        "title" : "REPL Test Selection",
        "id" : "repl-test-selection"
      }, {
        "title" : "Testing is Documenting",
        "id" : "testing-is-documenting"
      }, {
        "title" : "Capturing Test Artifacts",
        "id" : "capturing-test-artifacts"
      }, {
        "title" : "Example of Generated Documentation",
        "id" : "example-of-generated-documentation"
      }, {
        "title" : "Summary",
        "id" : "summary"
      }, {
        "title" : "To Get Started",
        "id" : "to-get-started"
      } ]
    }
  },
  "footer" : {
    "type" : "Footer",
    "content" : [ {
      "columns" : [ {
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "I am very passionate about testing and documentation. I believe they are two major aspects of software engineering that are being neglected by many engineers.",
            "type" : "SimpleText"
          } ]
        }, {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "Testing and documentation are intertwined and I hope to show you how much exactly.",
            "type" : "SimpleText"
          } ]
        } ]
      }, {
        "content" : [ {
          "type" : "Paragraph",
          "content" : [ {
            "text" : "I am new at writing, and especially English writing. Please be kind and suggest grammar improvements with ",
            "type" : "SimpleText"
          }, {
            "url" : "https://github.com/testingisdocumenting/blog",
            "isFile" : false,
            "type" : "Link",
            "content" : [ {
              "text" : "Pull Requests",
              "type" : "SimpleText"
            } ]
          } ]
        } ]
      } ],
      "config" : { },
      "type" : "Columns"
    } ]
  }
}), document.getElementById("znai"));
</script>

</body>
</html>
